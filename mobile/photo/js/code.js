(function(a){if(!Function.prototype.bind){Function.prototype.bind=function(e){var g=[].slice,b=g.call(arguments,1),f=this,d=function(){},c=function(){return f.apply(this instanceof d?this:(e||{}),b.concat(g.call(arguments)))};d.prototype=f.prototype;c.prototype=new d();return c}}if(typeof a.Code==="undefined"){a.Code={}}a.Code.Util={registerNamespace:function(){var b=arguments,k=null,d,e,f,g,l,c,h;for(d=0,c=b.length;d<c;d++){f=b[d];g=f.split(".");l=g[0];if(typeof a[l]==="undefined"){a[l]={}}k=a[l];for(e=1,h=g.length;e<h;++e){k[g[e]]=k[g[e]]||{};k=k[g[e]]}}},coalesce:function(){var b,c;for(b=0,c=arguments.length;b<c;b++){if(!this.isNothing(arguments[b])){return arguments[b]}}return null},extend:function(b,e,c){var d;if(this.isNothing(c)){c=true}if(b&&e&&this.isObject(e)){for(d in e){if(this.objectHasProperty(e,d)){if(c){b[d]=e[d]}else{if(typeof b[d]==="undefined"){b[d]=e[d]}}}}}},clone:function(b){var c={};this.extend(c,b);return c},isObject:function(b){return b instanceof Object},isFunction:function(b){return({}).toString.call(b)==="[object Function]"},isArray:function(b){return b instanceof Array},isLikeArray:function(b){return typeof b.length==="number"},isNumber:function(b){return typeof b==="number"},isString:function(b){return typeof b==="string"},isNothing:function(b){if(typeof b==="undefined"||b===null){return true}return false},swapArrayElements:function(b,c,d){var e=b[c];b[c]=b[d];b[d]=e},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},toCamelCase:function(b){return b.replace(/(\-[a-z])/g,function(c){return c.toUpperCase().replace("-","")})},toDashedCase:function(b){return b.replace(/([A-Z])/g,function(c){return"-"+c.toLowerCase()})},arrayIndexOf:function(f,b,g){var d,e,h,c;h=-1;for(d=0,e=b.length;d<e;d++){c=b[d];if(!this.isNothing(g)){if(this.objectHasProperty(c,g)){if(c[g]===f){h=d;break}}}else{if(c===f){h=d;break}}}return h},objectHasProperty:function(b,c){if(b.hasOwnProperty){return b.hasOwnProperty(c)}else{return("undefined"!==typeof b[c])}}}}(window));(function(b,a){a.Browser={ua:null,version:null,safari:null,webkit:null,opera:null,msie:null,chrome:null,mozilla:null,android:null,blackberry:null,iPad:null,iPhone:null,iPod:null,iOS:null,is3dSupported:null,isCSSTransformSupported:null,isTouchSupported:null,isGestureSupported:null,_detect:function(){this.ua=b.navigator.userAgent;this.version=(this.ua.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[]);this.safari=(/Safari/gi).test(b.navigator.appVersion);this.webkit=/webkit/i.test(this.ua);this.opera=/opera/i.test(this.ua);this.msie=/msie/i.test(this.ua)&&!this.opera;this.chrome=/Chrome/i.test(this.ua);this.firefox=/Firefox/i.test(this.ua);this.fennec=/Fennec/i.test(this.ua);this.mozilla=/mozilla/i.test(this.ua)&&!/(compatible|webkit)/.test(this.ua);this.android=/android/i.test(this.ua);this.blackberry=/blackberry/i.test(this.ua);this.iOS=(/iphone|ipod|ipad/gi).test(b.navigator.platform);this.iPad=(/ipad/gi).test(b.navigator.platform);this.iPhone=(/iphone/gi).test(b.navigator.platform);this.iPod=(/ipod/gi).test(b.navigator.platform);var c=document.createElement("div");this.is3dSupported=!a.isNothing(c.style.WebkitPerspective);this.isCSSTransformSupported=(!a.isNothing(c.style.WebkitTransform)||!a.isNothing(c.style.MozTransform)||!a.isNothing(c.style.transformProperty));this.isTouchSupported=this.isEventSupported("touchstart");this.isGestureSupported=this.isEventSupported("gesturestart")},_eventTagNames:{select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},isEventSupported:function(d){var c=document.createElement(this._eventTagNames[d]||"div"),e;d="on"+d;e=a.objectHasProperty(c,d);if(!e){c.setAttribute(d,"return;");e=typeof c[d]==="function"}c=null;return e},isLandscape:function(){return(a.DOM.windowWidth()>a.DOM.windowHeight())}};a.Browser._detect()}(window,window.Code.Util));(function(b,a){a.extend(a,{Events:{add:function(d,e,c){this._checkHandlersProperty(d);if(e==="mousewheel"){e=this._normaliseMouseWheelType()}if(typeof d.__eventHandlers[e]==="undefined"){d.__eventHandlers[e]=[]}d.__eventHandlers[e].push(c);if(this._isBrowserObject(d)){d.addEventListener(e,c,false)}},remove:function(g,h,c){this._checkHandlersProperty(g);if(h==="mousewheel"){h=this._normaliseMouseWheelType()}if(g.__eventHandlers[h] instanceof Array){var e,f,d=g.__eventHandlers[h];if(a.isNothing(c)){if(this._isBrowserObject(g)){for(e=0,f=d.length;e<f;e++){g.removeEventListener(h,d[e],false)}}g.__eventHandlers[h]=[];return}for(e=0,f=d.length;e<f;e++){if(d[e]===c){d.splice(e,1);break}}if(this._isBrowserObject(g)){g.removeEventListener(h,c,false);return}}},fire:function(l,m){var e,g,d,k,h,c=Array.prototype.slice.call(arguments).splice(2),f;if(m==="mousewheel"){m=this._normaliseMouseWheelType()}if(this._isBrowserObject(l)){if(typeof m!=="string"){throw"type must be a string for DOM elements"}f=this._NATIVE_EVENTS[m];d=document.createEvent(f?"HTMLEvents":"UIEvents");d[f?"initEvent":"initUIEvent"](m,true,true,b,1);if(c.length<1){l.dispatchEvent(d);return}}this._checkHandlersProperty(l);if(typeof m==="string"){d={type:m}}else{d=m}if(!d.target){d.target=l}if(!d.type){throw new Error("Event object missing 'type' property.")}if(l.__eventHandlers[d.type] instanceof Array){k=l.__eventHandlers[d.type];c.unshift(d);for(e=0,g=k.length;e<g;e++){h=k[e];if(!a.isNothing(h)){h.apply(l,c)}}}},getMousePosition:function(c){var d={x:0,y:0};if(c.pageX){d.x=c.pageX}else{if(c.clientX){d.x=c.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)}}if(c.pageY){d.y=c.pageY}else{if(c.clientY){d.y=c.clientY+(document.documentElement.scrollTop||document.body.scrollTop)}}return d},getTouchEvent:function(c){return c},getWheelDelta:function(d){var c=0;if(!a.isNothing(d.wheelDelta)){c=d.wheelDelta/120}else{if(!a.isNothing(d.detail)){c=-d.detail/3}}return c},domReady:function(c){document.addEventListener("DOMContentLoaded",c,false)},_checkHandlersProperty:function(c){if(a.isNothing(c.__eventHandlers)){a.extend(c,{__eventHandlers:{}})}},_isBrowserObject:function(c){if(c===b||c===b.document){return true}return this._isElement(c)||this._isNode(c)},_isElement:function(c){return(typeof b.HTMLElement==="object"?c instanceof b.HTMLElement:typeof c==="object"&&c.nodeType===1&&typeof c.nodeName==="string")},_isNode:function(c){return(typeof b.Node==="object"?c instanceof b.Node:typeof c==="object"&&typeof c.nodeType==="number"&&typeof c.nodeName==="string")},_normaliseMouseWheelType:function(){if(a.Browser.isEventSupported("mousewheel")){return"mousewheel"}return"DOMMouseScroll"},_NATIVE_EVENTS:{click:1,dblclick:1,mouseup:1,mousedown:1,contextmenu:1,mousewheel:1,DOMMouseScroll:1,mouseover:1,mouseout:1,mousemove:1,selectstart:1,selectend:1,keydown:1,keypress:1,keyup:1,orientationchange:1,touchstart:1,touchmove:1,touchend:1,touchcancel:1,gesturestart:1,gesturechange:1,gestureend:1,focus:1,blur:1,change:1,reset:1,select:1,submit:1,load:1,unload:1,beforeunload:1,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1}}})}(window,window.Code.Util));(function(b,a){a.extend(a,{DOM:{setData:function(c,e,g){if(a.isLikeArray(c)){var d,f;for(d=0,f=c.length;d<f;d++){a.DOM._setData(c[d],e,g)}}else{a.DOM._setData(c,e,g)}},_setData:function(c,d,e){a.DOM.setAttribute(c,"data-"+d,e)},getData:function(d,e,c){return a.DOM.getAttribute(d,"data-"+e,c)},removeData:function(c,e){if(a.isLikeArray(c)){var d,f;for(d=0,f=c.length;d<f;d++){a.DOM._removeData(c[d],e)}}else{a.DOM._removeData(c,e)}},_removeData:function(c,d){a.DOM.removeAttribute(c,"data-"+d)},isChildOf:function(c,d){if(d===c){return false}while(c&&c!==d){c=c.parentNode}return c===d},find:function(h,c){if(a.isNothing(c)){c=b.document}var d=c.querySelectorAll(h),g=[],e,f;for(e=0,f=d.length;e<f;e++){g.push(d[e])}return g},createElement:function(g,d,e){var c,f=document.createElement(g);for(c in d){if(a.objectHasProperty(d,c)){f.setAttribute(c,d[c])}}f.innerHTML=e||"";return f},appendChild:function(c,d){d.appendChild(c)},insertBefore:function(c,e,d){d.insertBefore(c,e)},appendText:function(d,c){a.DOM.appendChild(document.createTextNode(d),c)},appendToBody:function(c){this.appendChild(c,document.body)},removeChild:function(c,d){d.removeChild(c)},removeChildren:function(c){if(c.hasChildNodes()){while(c.childNodes.length>=1){c.removeChild(c.childNodes[c.childNodes.length-1])}}},hasAttribute:function(d,c){return !a.isNothing(d.getAttribute(c))},getAttribute:function(e,c,d){var f=e.getAttribute(c);if(a.isNothing(f)&&!a.isNothing(d)){f=d}return f},setAttribute:function(d,c,g){if(a.isLikeArray(d)){var e,f;for(e=0,f=d.length;e<f;e++){a.DOM._setAttribute(d[e],c,g)}}else{a.DOM._setAttribute(d,c,g)}},_setAttribute:function(d,c,e){d.setAttribute(c,e)},removeAttribute:function(d,c){if(a.isLikeArray(d)){var e,f;for(e=0,f=d.length;e<f;e++){a.DOM._removeAttribute(d[e],c)}}else{a.DOM._removeAttribute(d,c)}},_removeAttribute:function(d,c){if(this.hasAttribute(d,c)){d.removeAttribute(c)}},addClass:function(d,c){if(a.isLikeArray(d)){var e,f;for(e=0,f=d.length;e<f;e++){a.DOM._addClass(d[e],c)}}else{a.DOM._addClass(d,c)}},_addClass:function(e,c){var d=a.DOM.getAttribute(e,"class",""),f=new RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)");if(!f.test(d)){if(d!==""){d=d+" "}d=d+c;a.DOM.setAttribute(e,"class",d)}},removeClass:function(d,c){if(a.isLikeArray(d)){var e,f;for(e=0,f=d.length;e<f;e++){a.DOM._removeClass(d[e],c)}}else{a.DOM._removeClass(d,c)}},_removeClass:function(f,d){var e=a.DOM.getAttribute(f,"class",""),c=a.trim(e).split(" "),k="",g,h;for(g=0,h=c.length;g<h;g++){if(c[g]!==d){if(k!==""){k+=" "}k+=c[g]}}if(k===""){a.DOM.removeAttribute(f,"class")}else{a.DOM.setAttribute(f,"class",k)}},hasClass:function(d,c){var e=new RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)");return e.test(a.DOM.getAttribute(d,"class",""))},setStyle:function(c,f,g){if(a.isLikeArray(c)){var d,e;for(d=0,e=c.length;d<e;d++){a.DOM._setStyle(c[d],f,g)}}else{a.DOM._setStyle(c,f,g)}},_setStyle:function(c,e,g){var d,f;if(a.isObject(e)){for(d in e){if(a.objectHasProperty(e,d)){if(d==="width"){a.DOM.width(c,e[d])}else{if(d==="height"){a.DOM.height(c,e[d])}else{c.style[d]=e[d]}}}}}else{c.style[e]=g}},getStyle:function(c,e){var d=b.getComputedStyle(c,"").getPropertyValue(e);if(d===""){d=c.style[e]}return d},hide:function(c){if(a.isLikeArray(c)){var d,e;for(d=0,e=c.length;d<e;d++){a.DOM._hide(c[d])}}else{a.DOM._hide(c)}},_hide:function(c){a.DOM.setData(c,"ccl-disp",a.DOM.getStyle(c,"display"));a.DOM.setStyle(c,"display","none")},show:function(c){if(a.isLikeArray(c)){var d,e;for(d=0,e=c.length;d<e;d++){a.DOM._show(c[d])}}else{a.DOM._show(c)}},_show:function(c){if(a.DOM.getStyle(c,"display")==="none"){var d=a.DOM.getData(c,"ccl-disp","block");if(d==="none"||d===""){d="block"}a.DOM.setStyle(c,"display",d)}},width:function(c,d){if(!a.isNothing(d)){if(a.isNumber(d)){d=d+"px"}c.style.width=d}return this._getDimension(c,"width")},outerWidth:function(c){var d=a.DOM.width(c);d+=parseInt(a.DOM.getStyle(c,"padding-left"),10)+parseInt(a.DOM.getStyle(c,"padding-right"),10);d+=parseInt(a.DOM.getStyle(c,"margin-left"),10)+parseInt(a.DOM.getStyle(c,"margin-right"),10);d+=parseInt(a.DOM.getStyle(c,"border-left-width"),10)+parseInt(a.DOM.getStyle(c,"border-right-width"),10);return d},height:function(c,d){if(!a.isNothing(d)){if(a.isNumber(d)){d=d+"px"}c.style.height=d}return this._getDimension(c,"height")},_getDimension:function(d,c){var e=b.parseInt(b.getComputedStyle(d,"").getPropertyValue(c)),f;if(isNaN(e)){f={display:d.style.display,left:d.style.left};d.style.display="block";d.style.left="-1000000px";e=b.parseInt(b.getComputedStyle(d,"").getPropertyValue(c));d.style.display=f.display;d.style.left=f.left}return e},outerHeight:function(c){var d=a.DOM.height(c);d+=parseInt(a.DOM.getStyle(c,"padding-top"),10)+parseInt(a.DOM.getStyle(c,"padding-bottom"),10);d+=parseInt(a.DOM.getStyle(c,"margin-top"),10)+parseInt(a.DOM.getStyle(c,"margin-bottom"),10);d+=parseInt(a.DOM.getStyle(c,"border-top-width"),10)+parseInt(a.DOM.getStyle(c,"border-bottom-width"),10);return d},documentWidth:function(){return a.DOM.width(document.documentElement)},documentHeight:function(){return a.DOM.height(document.documentElement)},documentOuterWidth:function(){return a.DOM.width(document.documentElement)},documentOuterHeight:function(){return a.DOM.outerHeight(document.documentElement)},bodyWidth:function(){return a.DOM.width(document.body)},bodyHeight:function(){return a.DOM.height(document.body)},bodyOuterWidth:function(){return a.DOM.outerWidth(document.body)},bodyOuterHeight:function(){return a.DOM.outerHeight(document.body)},windowWidth:function(){return b.innerWidth},windowHeight:function(){return b.innerHeight},windowScrollLeft:function(){return b.pageXOffset},windowScrollTop:function(){return b.pageYOffset}}})}(window,window.Code.Util));(function(b,a){a.extend(a,{Animation:{_applyTransitionDelay:50,_transitionEndLabel:(b.document.documentElement.style.webkitTransition!==undefined)?"webkitTransitionEnd":"transitionend",_transitionEndHandler:null,_transitionPrefix:(b.document.documentElement.style.webkitTransition!==undefined)?"webkitTransition":(b.document.documentElement.style.MozTransition!==undefined)?"MozTransition":"transition",_transformLabel:(b.document.documentElement.style.webkitTransform!==undefined)?"webkitTransform":(b.document.documentElement.style.MozTransition!==undefined)?"MozTransform":"transform",_getTransitionEndHandler:function(){if(a.isNothing(this._transitionEndHandler)){this._transitionEndHandler=this._onTransitionEnd.bind(this)}return this._transitionEndHandler},stop:function(d){if(a.Browser.isCSSTransformSupported){var e=d.style[this._transitionPrefix+"Property"],c=(e!=="")?"ccl"+e+"callback":"cclallcallback",f={};a.Events.remove(d,this._transitionEndLabel,this._getTransitionEndHandler());if(a.isNothing(d.callbackLabel)){delete d.callbackLabel}f[this._transitionPrefix+"Property"]="";f[this._transitionPrefix+"Duration"]="";f[this._transitionPrefix+"TimingFunction"]="";f[this._transitionPrefix+"Delay"]="";f[this._transformLabel]="";a.DOM.setStyle(d,f)}else{if(!a.isNothing(b.jQuery)){b.jQuery(d).stop(true,true)}}},fadeIn:function(e,g,c,h,f){f=a.coalesce(f,1);if(f<=0){f=1}if(g<=0){a.DOM.setStyle(e,"opacity",f);if(!a.isNothing(c)){c(e);return}}var d=a.DOM.getStyle(e,"opacity");if(d>=1){a.DOM.setStyle(e,"opacity",0)}if(a.Browser.isCSSTransformSupported){this._applyTransition(e,"opacity",f,g,c,h)}else{if(!a.isNothing(b.jQuery)){b.jQuery(e).fadeTo(g,f,c)}}},fadeTo:function(d,e,f,c,g){this.fadeIn(d,f,c,g,e)},fadeOut:function(d,e,c,f){if(e<=0){a.DOM.setStyle(d,"opacity",0);if(!a.isNothing(c)){c(d);return}}if(a.Browser.isCSSTransformSupported){this._applyTransition(d,"opacity",0,e,c,f)}else{b.jQuery(d).fadeTo(e,0,c)}},slideBy:function(d,h,i,e,c,g){var f={};h=a.coalesce(h,0);i=a.coalesce(i,0);g=a.coalesce(g,"ease-out");f[this._transitionPrefix+"Property"]="all";f[this._transitionPrefix+"Delay"]="0";if(e===0){f[this._transitionPrefix+"Duration"]="";f[this._transitionPrefix+"TimingFunction"]=""}else{f[this._transitionPrefix+"Duration"]=e+"ms";f[this._transitionPrefix+"TimingFunction"]=a.coalesce(g,"ease-out");a.Events.add(d,this._transitionEndLabel,this._getTransitionEndHandler())}f[this._transformLabel]=(a.Browser.is3dSupported)?"translate3d("+h+"px, "+i+"px, 0px)":"translate("+h+"px, "+i+"px)";if(!a.isNothing(c)){d.cclallcallback=c}a.DOM.setStyle(d,f);if(e===0){b.setTimeout(function(){this._leaveTransforms(d)}.bind(this),this._applyTransitionDelay)}},resetTranslate:function(c){var d={};d[this._transformLabel]=d[this._transformLabel]=(a.Browser.is3dSupported)?"translate3d(0px, 0px, 0px)":"translate(0px, 0px)";a.DOM.setStyle(c,d)},_applyTransition:function(d,e,i,f,c,h){var g={};h=a.coalesce(h,"ease-in");g[this._transitionPrefix+"Property"]=e;g[this._transitionPrefix+"Duration"]=f+"ms";g[this._transitionPrefix+"TimingFunction"]=h;g[this._transitionPrefix+"Delay"]="0";a.Events.add(d,this._transitionEndLabel,this._getTransitionEndHandler());a.DOM.setStyle(d,g);if(!a.isNothing(c)){d["ccl"+e+"callback"]=c}b.setTimeout(function(){a.DOM.setStyle(d,e,i)},this._applyTransitionDelay)},_onTransitionEnd:function(c){a.Events.remove(c.currentTarget,this._transitionEndLabel,this._getTransitionEndHandler());this._leaveTransforms(c.currentTarget)},_leaveTransforms:function(g){var h=g.style[this._transitionPrefix+"Property"],d=(h!=="")?"ccl"+h+"callback":"cclallcallback",c,j=a.coalesce(g.style.webkitTransform,g.style.MozTransform,g.style.transform),n,m,e=b.parseInt(a.DOM.getStyle(g,"left"),0),f=b.parseInt(a.DOM.getStyle(g,"top"),0),k,l,i={};if(j!==""){if(a.Browser.is3dSupported){n=j.match(/translate3d\((.*?)\)/)}else{n=j.match(/translate\((.*?)\)/)}if(!a.isNothing(n)){m=n[1].split(", ");k=b.parseInt(m[0],0);l=b.parseInt(m[1],0)}}i[this._transitionPrefix+"Property"]="";i[this._transitionPrefix+"Duration"]="";i[this._transitionPrefix+"TimingFunction"]="";i[this._transitionPrefix+"Delay"]="";a.DOM.setStyle(g,i);b.setTimeout(function(){if(!a.isNothing(m)){i={};i[this._transformLabel]="";i.left=(e+k)+"px";i.top=(f+l)+"px";a.DOM.setStyle(g,i)}if(!a.isNothing(g[d])){c=g[d];delete g[d];c(g)}}.bind(this),this._applyTransitionDelay)}}})}(window,window.Code.Util));(function(c,a,b){b.registerNamespace("Code.Util.TouchElement");b.TouchElement.EventTypes={onTouch:"CodeUtilTouchElementOnTouch"};b.TouchElement.ActionTypes={touchStart:"touchStart",touchMove:"touchMove",touchEnd:"touchEnd",touchMoveEnd:"touchMoveEnd",tap:"tap",doubleTap:"doubleTap",swipeLeft:"swipeLeft",swipeRight:"swipeRight",swipeUp:"swipeUp",swipeDown:"swipeDown",gestureStart:"gestureStart",gestureChange:"gestureChange",gestureEnd:"gestureEnd"}}(window,window.klass,window.Code.Util));(function(c,a,b){b.registerNamespace("Code.Util.TouchElement");b.TouchElement.TouchElementClass=a({el:null,captureSettings:null,touchStartPoint:null,touchEndPoint:null,touchStartTime:null,doubleTapTimeout:null,touchStartHandler:null,touchMoveHandler:null,touchEndHandler:null,mouseDownHandler:null,mouseMoveHandler:null,mouseUpHandler:null,mouseOutHandler:null,gestureStartHandler:null,gestureChangeHandler:null,gestureEndHandler:null,swipeThreshold:null,swipeTimeThreshold:null,doubleTapSpeed:null,dispose:function(){var d;this.removeEventHandlers();for(d in this){if(b.objectHasProperty(this,d)){this[d]=null}}},initialize:function(e,d){this.el=e;this.captureSettings={swipe:false,move:false,gesture:false,doubleTap:false,preventDefaultTouchEvents:true,allowVerticalScroll:true};b.extend(this.captureSettings,d);this.swipeThreshold=50;this.swipeTimeThreshold=250;this.doubleTapSpeed=250;this.touchStartPoint={x:0,y:0};this.touchEndPoint={x:0,y:0}},addEventHandlers:function(){if(b.isNothing(this.touchStartHandler)){this.touchStartHandler=this.onTouchStart.bind(this);this.touchMoveHandler=this.onTouchMove.bind(this);this.touchEndHandler=this.onTouchEnd.bind(this);this.mouseDownHandler=this.onMouseDown.bind(this);this.mouseMoveHandler=this.onMouseMove.bind(this);this.mouseUpHandler=this.onMouseUp.bind(this);this.mouseOutHandler=this.onMouseOut.bind(this);this.gestureStartHandler=this.onGestureStart.bind(this);this.gestureChangeHandler=this.onGestureChange.bind(this);this.gestureEndHandler=this.onGestureEnd.bind(this)}b.Events.add(this.el,"touchstart",this.touchStartHandler);if(this.captureSettings.move){b.Events.add(this.el,"touchmove",this.touchMoveHandler)}b.Events.add(this.el,"touchend",this.touchEndHandler);b.Events.add(this.el,"mousedown",this.mouseDownHandler);if(b.Browser.isGestureSupported&&this.captureSettings.gesture){b.Events.add(this.el,"gesturestart",this.gestureStartHandler);b.Events.add(this.el,"gesturechange",this.gestureChangeHandler);b.Events.add(this.el,"gestureend",this.gestureEndHandler)}},removeEventHandlers:function(){b.Events.remove(this.el,"touchstart",this.touchStartHandler);if(this.captureSettings.move){b.Events.remove(this.el,"touchmove",this.touchMoveHandler)}b.Events.remove(this.el,"touchend",this.touchEndHandler);b.Events.remove(this.el,"mousedown",this.mouseDownHandler);if(b.Browser.isGestureSupported&&this.captureSettings.gesture){b.Events.remove(this.el,"gesturestart",this.gestureStartHandler);b.Events.remove(this.el,"gesturechange",this.gestureChangeHandler);b.Events.remove(this.el,"gestureend",this.gestureEndHandler)}},getTouchPoint:function(d){return{x:d[0].pageX,y:d[0].pageY}},fireTouchEvent:function(j){var d,h=0,i=0,g=0,l,k,f;h=this.touchEndPoint.x-this.touchStartPoint.x;i=this.touchEndPoint.y-this.touchStartPoint.y;g=Math.sqrt((h*h)+(i*i));if(this.captureSettings.swipe){k=new Date();f=k-this.touchStartTime;if(f<=this.swipeTimeThreshold){if(c.Math.abs(h)>=this.swipeThreshold){b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:(h<0)?b.TouchElement.ActionTypes.swipeLeft:b.TouchElement.ActionTypes.swipeRight,targetEl:j.target,currentTargetEl:j.currentTarget});return}if(c.Math.abs(i)>=this.swipeThreshold){b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:(i<0)?b.TouchElement.ActionTypes.swipeUp:b.TouchElement.ActionTypes.swipeDown,targetEl:j.target,currentTargetEl:j.currentTarget});return}}}if(g>1){b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchMoveEnd,point:this.touchEndPoint,targetEl:j.target,currentTargetEl:j.currentTarget});return}if(!this.captureSettings.doubleTap){b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:b.TouchElement.ActionTypes.tap,targetEl:j.target,currentTargetEl:j.currentTarget});return}if(b.isNothing(this.doubleTapTimeout)){this.doubleTapTimeout=c.setTimeout(function(){this.doubleTapTimeout=null;b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:b.TouchElement.ActionTypes.tap,targetEl:j.target,currentTargetEl:j.currentTarget})}.bind(this),this.doubleTapSpeed);return}else{c.clearTimeout(this.doubleTapTimeout);this.doubleTapTimeout=null;b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:b.TouchElement.ActionTypes.doubleTap,targetEl:j.target,currentTargetEl:j.currentTarget})}},onTouchStart:function(d){if(this.captureSettings.preventDefaultTouchEvents&&!this.captureSettings.allowVerticalScroll){d.preventDefault()}b.Events.remove(this.el,"mousedown",this.mouseDownHandler);var g=b.Events.getTouchEvent(d),f=g.touches;if(f.length>1&&this.captureSettings.gesture){this.isGesture=true;return}this.touchStartTime=new Date();this.isGesture=false;this.touchStartPoint=this.getTouchPoint(f);b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchStart,point:this.touchStartPoint,targetEl:d.target,currentTargetEl:d.currentTarget})},onTouchMove:function(d){if(this.isGesture&&this.captureSettings.gesture){return}var h=b.Events.getTouchEvent(d),g=h.touches;var f=this.getTouchPoint(g);if(this.captureSettings.allowVerticalScroll&&Math.abs(this.touchStartPoint.x-f.x)<Math.abs(this.touchStartPoint.y-f.y)){return}if(this.captureSettings.preventDefaultTouchEvents){d.preventDefault()}b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchMove,point:f,targetEl:d.target,currentTargetEl:d.currentTarget})},onTouchEnd:function(d){if(this.isGesture&&this.captureSettings.gesture){return}var g=b.Events.getTouchEvent(d),f=(!b.isNothing(g.changedTouches))?g.changedTouches:g.touches;this.touchEndPoint=this.getTouchPoint(f);if(this.captureSettings.allowVerticalScroll&&Math.abs(this.touchStartPoint.x-this.touchEndPoint.x)<Math.abs(this.touchStartPoint.y-this.touchEndPoint.y)){return}if(this.captureSettings.preventDefaultTouchEvents){d.preventDefault()}b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchEnd,point:this.touchEndPoint,targetEl:d.target,currentTargetEl:d.currentTarget});this.fireTouchEvent(d)},onMouseDown:function(d){d.preventDefault();b.Events.remove(this.el,"touchstart",this.mouseDownHandler);b.Events.remove(this.el,"touchmove",this.touchMoveHandler);b.Events.remove(this.el,"touchend",this.touchEndHandler);if(this.captureSettings.move){b.Events.add(this.el,"mousemove",this.mouseMoveHandler)}b.Events.add(this.el,"mouseup",this.mouseUpHandler);b.Events.add(this.el,"mouseout",this.mouseOutHandler);this.touchStartTime=new Date();this.isGesture=false;this.touchStartPoint=b.Events.getMousePosition(d);b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchStart,point:this.touchStartPoint,targetEl:d.target,currentTargetEl:d.currentTarget})},onMouseMove:function(d){d.preventDefault();b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchMove,point:b.Events.getMousePosition(d),targetEl:d.target,currentTargetEl:d.currentTarget})},onMouseUp:function(d){d.preventDefault();if(this.captureSettings.move){b.Events.remove(this.el,"mousemove",this.mouseMoveHandler)}b.Events.remove(this.el,"mouseup",this.mouseUpHandler);b.Events.remove(this.el,"mouseout",this.mouseOutHandler);this.touchEndPoint=b.Events.getMousePosition(d);b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchEnd,point:this.touchEndPoint,targetEl:d.target,currentTargetEl:d.currentTarget});this.fireTouchEvent(d)},onMouseOut:function(d){var f=d.relatedTarget;if(this.el===f||b.DOM.isChildOf(f,this.el)){return}d.preventDefault();if(this.captureSettings.move){b.Events.remove(this.el,"mousemove",this.mouseMoveHandler)}b.Events.remove(this.el,"mouseup",this.mouseUpHandler);b.Events.remove(this.el,"mouseout",this.mouseOutHandler);this.touchEndPoint=b.Events.getMousePosition(d);b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.touchEnd,point:this.touchEndPoint,targetEl:d.target,currentTargetEl:d.currentTarget});this.fireTouchEvent(d)},onGestureStart:function(d){d.preventDefault();var f=b.Events.getTouchEvent(d);b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.gestureStart,scale:f.scale,rotation:f.rotation,targetEl:d.target,currentTargetEl:d.currentTarget})},onGestureChange:function(d){d.preventDefault();var f=b.Events.getTouchEvent(d);b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.gestureChange,scale:f.scale,rotation:f.rotation,targetEl:d.target,currentTargetEl:d.currentTarget})},onGestureEnd:function(d){d.preventDefault();var f=b.Events.getTouchEvent(d);b.Events.fire(this,{type:b.TouchElement.EventTypes.onTouch,target:this,action:b.TouchElement.ActionTypes.gestureEnd,scale:f.scale,rotation:f.rotation,targetEl:d.target,currentTargetEl:d.currentTarget})}})}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Image");var b=d.Code.PhotoSwipe;b.Image.EventTypes={onLoad:"onLoad",onError:"onError"}}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Image");var b=d.Code.PhotoSwipe;b.Image.ImageClass=a({refObj:null,imageEl:null,src:null,caption:null,metaData:null,imageLoadHandler:null,imageErrorHandler:null,dispose:function(){var f,e;this.shrinkImage();for(f in this){if(c.objectHasProperty(this,f)){this[f]=null}}},initialize:function(g,h,e,f){this.refObj=g;this.originalSrc=h;this.src=h;this.caption=e;this.metaData=f;this.imageEl=new d.Image();this.imageLoadHandler=this.onImageLoad.bind(this);this.imageErrorHandler=this.onImageError.bind(this)},load:function(){this.imageEl.originalSrc=c.coalesce(this.imageEl.originalSrc,"");if(this.imageEl.originalSrc===this.src){if(this.imageEl.isError){c.Events.fire(this,{type:b.Image.EventTypes.onError,target:this})}else{c.Events.fire(this,{type:b.Image.EventTypes.onLoad,target:this})}return}this.imageEl.isError=false;this.imageEl.isLoading=true;this.imageEl.naturalWidth=null;this.imageEl.naturalHeight=null;this.imageEl.isLandscape=false;this.imageEl.onload=this.imageLoadHandler;this.imageEl.onerror=this.imageErrorHandler;this.imageEl.onabort=this.imageErrorHandler;this.imageEl.originalSrc=this.src;this.imageEl.src=this.src},shrinkImage:function(){if(c.isNothing(this.imageEl)){return}if(this.imageEl.src.indexOf(this.src)>-1){this.imageEl.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";if(!c.isNothing(this.imageEl.parentNode)){c.DOM.removeChild(this.imageEl,this.imageEl.parentNode)}}},onImageLoad:function(f){this.imageEl.onload=null;this.imageEl.naturalWidth=c.coalesce(this.imageEl.naturalWidth,this.imageEl.width);this.imageEl.naturalHeight=c.coalesce(this.imageEl.naturalHeight,this.imageEl.height);this.imageEl.isLandscape=(this.imageEl.naturalWidth>this.imageEl.naturalHeight);this.imageEl.isLoading=false;c.Events.fire(this,{type:b.Image.EventTypes.onLoad,target:this})},onImageError:function(f){this.imageEl.onload=null;this.imageEl.onerror=null;this.imageEl.onabort=null;this.imageEl.isLoading=false;this.imageEl.isError=true;c.Events.fire(this,{type:b.Image.EventTypes.onError,target:this})}})}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Cache");var b=d.Code.PhotoSwipe;b.Cache.Mode={normal:"normal",aggressive:"aggressive"};b.Cache.Functions={getImageSource:function(e){return e.href},getImageCaption:function(f){if(f.nodeName==="IMG"){return c.DOM.getAttribute(f,"alt")}var g,h,e;for(g=0,h=f.childNodes.length;g<h;g++){e=f.childNodes[g];if(f.childNodes[g].nodeName==="IMG"){return c.DOM.getAttribute(e,"alt")}}},getImageMetaData:function(e){return{}}}}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Cache");var b=d.Code.PhotoSwipe;b.Cache.CacheClass=a({images:null,settings:null,dispose:function(){var g,e,f;if(!c.isNothing(this.images)){for(e=0,f=this.images.length;e<f;e++){this.images[e].dispose()}this.images.length=0}for(g in this){if(c.objectHasProperty(this,g)){this[g]=null}}},initialize:function(k,n){var g,l,e,h,o,f,m;this.settings=n;this.images=[];for(g=0,l=k.length;g<l;g++){h=k[g];o=this.settings.getImageSource(h);f=this.settings.getImageCaption(h);m=this.settings.getImageMetaData(h);this.images.push(new b.Image.ImageClass(h,o,f,m))}},getImages:function(g){var f,h,k=[],e;for(f=0,h=g.length;f<h;f++){e=this.images[g[f]];if(this.settings.cacheMode===b.Cache.Mode.aggressive){e.cacheDoNotShrink=true}k.push(e)}if(this.settings.cacheMode===b.Cache.Mode.aggressive){for(f=0,h=this.images.length;f<h;f++){e=this.images[f];if(!c.objectHasProperty(e,"cacheDoNotShrink")){e.shrinkImage()}else{delete e.cacheDoNotShrink}}}return k}})}(window,window.klass,window.Code.Util,window.Code.PhotoSwipe.Image));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.DocumentOverlay");var b=d.Code.PhotoSwipe;b.DocumentOverlay.CssClasses={documentOverlay:"ps-document-overlay"}}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.DocumentOverlay");var b=d.Code.PhotoSwipe;b.DocumentOverlay.DocumentOverlayClass=a({el:null,settings:null,initialBodyHeight:null,dispose:function(){var e;c.Animation.stop(this.el);c.DOM.removeChild(this.el,this.el.parentNode);for(e in this){if(c.objectHasProperty(this,e)){this[e]=null}}},initialize:function(e){this.settings=e;this.el=c.DOM.createElement("div",{"class":b.DocumentOverlay.CssClasses.documentOverlay},"");c.DOM.setStyle(this.el,{display:"block",position:"absolute",left:0,top:0,zIndex:this.settings.zIndex});c.DOM.hide(this.el);if(this.settings.target===d){c.DOM.appendToBody(this.el)}else{c.DOM.appendChild(this.el,this.settings.target)}c.Animation.resetTranslate(this.el);this.initialBodyHeight=c.DOM.bodyOuterHeight()},resetPosition:function(){var g,e,f;if(this.settings.target===d){g=c.DOM.windowWidth();e=c.DOM.bodyOuterHeight()*2;f=(this.settings.jQueryMobile)?c.DOM.windowScrollTop()+"px":"0px";if(e<1){e=this.initialBodyHeight}if(c.DOM.windowHeight()>e){e=c.DOM.windowHeight()}}else{g=c.DOM.width(this.settings.target);e=c.DOM.height(this.settings.target);f="0px"}c.DOM.setStyle(this.el,{width:g,height:e,top:f})},fadeIn:function(f,e){this.resetPosition();c.DOM.setStyle(this.el,"opacity",0);c.DOM.show(this.el);c.Animation.fadeIn(this.el,f,e)}})}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Carousel");var b=d.Code.PhotoSwipe;b.Carousel.EventTypes={onSlideByEnd:"PhotoSwipeCarouselOnSlideByEnd",onSlideshowStart:"PhotoSwipeCarouselOnSlideshowStart",onSlideshowStop:"PhotoSwipeCarouselOnSlideshowStop"};b.Carousel.CssClasses={carousel:"ps-carousel",content:"ps-carousel-content",item:"ps-carousel-item",itemLoading:"ps-carousel-item-loading",itemError:"ps-carousel-item-error"};b.Carousel.SlideByAction={previous:"previous",current:"current",next:"next"}}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Carousel");var b=d.Code.PhotoSwipe;b.Carousel.CarouselClass=a({el:null,contentEl:null,settings:null,cache:null,slideByEndHandler:null,currentCacheIndex:null,isSliding:null,isSlideshowActive:null,lastSlideByAction:null,touchStartPoint:null,touchStartPosition:null,imageLoadHandler:null,imageErrorHandler:null,slideshowTimeout:null,dispose:function(){var g,e,f;for(e=0,f=this.cache.images.length;e<f;e++){c.Events.remove(this.cache.images[e],b.Image.EventTypes.onLoad,this.imageLoadHandler);c.Events.remove(this.cache.images[e],b.Image.EventTypes.onError,this.imageErrorHandler)}this.stopSlideshow();c.Animation.stop(this.el);c.DOM.removeChild(this.el,this.el.parentNode);for(g in this){if(c.objectHasProperty(this,g)){this[g]=null}}},initialize:function(e,h){var f,j,g;this.cache=e;this.settings=h;this.slideByEndHandler=this.onSlideByEnd.bind(this);this.imageLoadHandler=this.onImageLoad.bind(this);this.imageErrorHandler=this.onImageError.bind(this);this.currentCacheIndex=0;this.isSliding=false;this.isSlideshowActive=false;if(this.cache.images.length<3){this.settings.loop=false}this.el=c.DOM.createElement("div",{"class":b.Carousel.CssClasses.carousel},"");c.DOM.setStyle(this.el,{display:"block",position:"absolute",left:0,top:0,overflow:"hidden",zIndex:this.settings.zIndex});c.DOM.hide(this.el);this.contentEl=c.DOM.createElement("div",{"class":b.Carousel.CssClasses.content},"");c.DOM.setStyle(this.contentEl,{display:"block",position:"absolute",left:0,top:0});c.DOM.appendChild(this.contentEl,this.el);j=(e.images.length<3)?e.images.length:3;for(f=0;f<j;f++){g=c.DOM.createElement("div",{"class":b.Carousel.CssClasses.item+" "+b.Carousel.CssClasses.item+"-"+f},"");c.DOM.setAttribute(g,"style","float: left;");c.DOM.setStyle(g,{display:"block",position:"relative",left:0,top:0,overflow:"hidden"});if(this.settings.margin>0){c.DOM.setStyle(g,{marginRight:this.settings.margin+"px"})}c.DOM.appendChild(g,this.contentEl)}if(this.settings.target===d){c.DOM.appendToBody(this.el)}else{c.DOM.appendChild(this.el,this.settings.target)}},resetPosition:function(){var p,f,o,m,l,e,g,n,k,h;if(this.settings.target===d){p=c.DOM.windowWidth();f=c.DOM.windowHeight();o=c.DOM.windowScrollTop()+"px"}else{p=c.DOM.width(this.settings.target);f=c.DOM.height(this.settings.target);o="0px"}m=(this.settings.margin>0)?p+this.settings.margin:p;l=c.DOM.find("."+b.Carousel.CssClasses.item,this.contentEl);e=m*l.length;c.DOM.setStyle(this.el,{top:o,width:p,height:f});c.DOM.setStyle(this.contentEl,{width:e,height:f});for(g=0,n=l.length;g<n;g++){k=l[g];c.DOM.setStyle(k,{width:p,height:f});h=c.DOM.find("img",k)[0];if(!c.isNothing(h)){this.resetImagePosition(h)}}this.setContentLeftPosition()},resetImagePosition:function(e){if(c.isNothing(e)){return}var m=c.DOM.getAttribute(e,"src"),l,k,h,j,i,g=c.DOM.width(this.el),f=c.DOM.height(this.el);if(this.settings.imageScaleMethod==="fitNoUpscale"){k=e.naturalWidth;h=e.naturalHeight;if(k>g){l=g/k;k=Math.round(k*l);h=Math.round(h*l)}if(h>f){l=f/h;h=Math.round(h*l);k=Math.round(k*l)}}else{if(e.isLandscape){l=g/e.naturalWidth}else{l=f/e.naturalHeight}k=Math.round(e.naturalWidth*l);h=Math.round(e.naturalHeight*l);if(this.settings.imageScaleMethod==="zoom"){l=1;if(h<f){l=f/h}else{if(k<g){l=g/k}}if(l!==1){k=Math.round(k*l);h=Math.round(h*l)}}else{if(this.settings.imageScaleMethod==="fit"){l=1;if(k>g){l=g/k}else{if(h>f){l=f/h}}if(l!==1){k=Math.round(k*l);h=Math.round(h*l)}}}}j=Math.round(((f-h)/2))+"px";i=Math.round(((g-k)/2))+"px";c.DOM.setStyle(e,{position:"absolute",width:k,height:h,top:j,left:i,display:"block"})},setContentLeftPosition:function(){var g,e,f;if(this.settings.target===d){g=c.DOM.windowWidth()}else{g=c.DOM.width(this.settings.target)}e=this.getItemEls();f=0;if(this.settings.loop){f=(g+this.settings.margin)*-1}else{if(this.currentCacheIndex===this.cache.images.length-1){f=((e.length-1)*(g+this.settings.margin))*-1}else{if(this.currentCacheIndex>0){f=(g+this.settings.margin)*-1}}}c.DOM.setStyle(this.contentEl,{left:f+"px"})},show:function(f){this.currentCacheIndex=f;this.resetPosition();this.setImages(false);c.DOM.show(this.el);c.Animation.resetTranslate(this.contentEl);var g=this.getItemEls(),e,h;for(e=0,h=g.length;e<h;e++){c.Animation.resetTranslate(g[e])}c.Events.fire(this,{type:b.Carousel.EventTypes.onSlideByEnd,target:this,action:b.Carousel.SlideByAction.current,cacheIndex:this.currentCacheIndex})},setImages:function(f){var e,g=this.getItemEls(),h=this.currentCacheIndex+1,i=this.currentCacheIndex-1;if(this.settings.loop){if(h>this.cache.images.length-1){h=0}if(i<0){i=this.cache.images.length-1}e=this.cache.getImages([i,this.currentCacheIndex,h]);if(!f){this.addCacheImageToItemEl(e[1],g[1])}this.addCacheImageToItemEl(e[2],g[2]);this.addCacheImageToItemEl(e[0],g[0])}else{if(g.length===1){if(!f){e=this.cache.getImages([this.currentCacheIndex]);this.addCacheImageToItemEl(e[0],g[0])}}else{if(g.length===2){if(this.currentCacheIndex===0){e=this.cache.getImages([this.currentCacheIndex,this.currentCacheIndex+1]);if(!f){this.addCacheImageToItemEl(e[0],g[0])}this.addCacheImageToItemEl(e[1],g[1])}else{e=this.cache.getImages([this.currentCacheIndex-1,this.currentCacheIndex]);if(!f){this.addCacheImageToItemEl(e[1],g[1])}this.addCacheImageToItemEl(e[0],g[0])}}else{if(this.currentCacheIndex===0){e=this.cache.getImages([this.currentCacheIndex,this.currentCacheIndex+1,this.currentCacheIndex+2]);if(!f){this.addCacheImageToItemEl(e[0],g[0])}this.addCacheImageToItemEl(e[1],g[1]);this.addCacheImageToItemEl(e[2],g[2])}else{if(this.currentCacheIndex===this.cache.images.length-1){e=this.cache.getImages([this.currentCacheIndex-2,this.currentCacheIndex-1,this.currentCacheIndex]);if(!f){this.addCacheImageToItemEl(e[2],g[2])}this.addCacheImageToItemEl(e[1],g[1]);this.addCacheImageToItemEl(e[0],g[0])}else{e=this.cache.getImages([this.currentCacheIndex-1,this.currentCacheIndex,this.currentCacheIndex+1]);if(!f){this.addCacheImageToItemEl(e[1],g[1])}this.addCacheImageToItemEl(e[2],g[2]);this.addCacheImageToItemEl(e[0],g[0])}}}}}},addCacheImageToItemEl:function(e,f){c.DOM.removeClass(f,b.Carousel.CssClasses.itemError);c.DOM.addClass(f,b.Carousel.CssClasses.itemLoading);c.DOM.removeChildren(f);c.DOM.setStyle(e.imageEl,{display:"none"});c.DOM.appendChild(e.imageEl,f);c.Animation.resetTranslate(e.imageEl);c.Events.add(e,b.Image.EventTypes.onLoad,this.imageLoadHandler);c.Events.add(e,b.Image.EventTypes.onError,this.imageErrorHandler);e.load()},slideCarousel:function(g,e,i){if(this.isSliding){return}var j,f,h;if(this.settings.target===d){j=c.DOM.windowWidth()+this.settings.margin}else{j=c.DOM.width(this.settings.target)+this.settings.margin}i=c.coalesce(i,this.settings.slideSpeed);if(d.Math.abs(f)<1){return}switch(e){case c.TouchElement.ActionTypes.swipeLeft:h=j*-1;break;case c.TouchElement.ActionTypes.swipeRight:h=j;break;default:f=g.x-this.touchStartPoint.x;if(d.Math.abs(f)>j/2){h=(f>0)?j:j*-1}else{h=0}break}if(h<0){this.lastSlideByAction=b.Carousel.SlideByAction.next}else{if(h>0){this.lastSlideByAction=b.Carousel.SlideByAction.previous}else{this.lastSlideByAction=b.Carousel.SlideByAction.current}}if(!this.settings.loop){if((this.lastSlideByAction===b.Carousel.SlideByAction.previous&&this.currentCacheIndex===0)||(this.lastSlideByAction===b.Carousel.SlideByAction.next&&this.currentCacheIndex===this.cache.images.length-1)){h=0;this.lastSlideByAction=b.Carousel.SlideByAction.current}}this.isSliding=true;this.doSlideCarousel(h,i)},moveCarousel:function(e){if(this.isSliding){return}if(!this.settings.enableDrag){return}this.doMoveCarousel(e.x-this.touchStartPoint.x)},getItemEls:function(){return c.DOM.find("."+b.Carousel.CssClasses.item,this.contentEl)},previous:function(){this.stopSlideshow();this.slideCarousel({x:0,y:0},c.TouchElement.ActionTypes.swipeRight,this.settings.nextPreviousSlideSpeed)},next:function(){this.stopSlideshow();this.slideCarousel({x:0,y:0},c.TouchElement.ActionTypes.swipeLeft,this.settings.nextPreviousSlideSpeed)},slideshowNext:function(){this.slideCarousel({x:0,y:0},c.TouchElement.ActionTypes.swipeLeft)},startSlideshow:function(){this.stopSlideshow();this.isSlideshowActive=true;this.slideshowTimeout=d.setTimeout(this.slideshowNext.bind(this),this.settings.slideshowDelay);c.Events.fire(this,{type:b.Carousel.EventTypes.onSlideshowStart,target:this})},stopSlideshow:function(){if(!c.isNothing(this.slideshowTimeout)){d.clearTimeout(this.slideshowTimeout);this.slideshowTimeout=null;this.isSlideshowActive=false;c.Events.fire(this,{type:b.Carousel.EventTypes.onSlideshowStop,target:this})}},onSlideByEnd:function(f){if(c.isNothing(this.isSliding)){return}var g=this.getItemEls();this.isSliding=false;if(this.lastSlideByAction===b.Carousel.SlideByAction.next){this.currentCacheIndex=this.currentCacheIndex+1}else{if(this.lastSlideByAction===b.Carousel.SlideByAction.previous){this.currentCacheIndex=this.currentCacheIndex-1}}if(this.settings.loop){if(this.lastSlideByAction===b.Carousel.SlideByAction.next){c.DOM.appendChild(g[0],this.contentEl)}else{if(this.lastSlideByAction===b.Carousel.SlideByAction.previous){c.DOM.insertBefore(g[g.length-1],g[0],this.contentEl)}}if(this.currentCacheIndex<0){this.currentCacheIndex=this.cache.images.length-1}else{if(this.currentCacheIndex===this.cache.images.length){this.currentCacheIndex=0}}}else{if(this.cache.images.length>3){if(this.currentCacheIndex>1&&this.currentCacheIndex<this.cache.images.length-2){if(this.lastSlideByAction===b.Carousel.SlideByAction.next){c.DOM.appendChild(g[0],this.contentEl)}else{if(this.lastSlideByAction===b.Carousel.SlideByAction.previous){c.DOM.insertBefore(g[g.length-1],g[0],this.contentEl)}}}else{if(this.currentCacheIndex===1){if(this.lastSlideByAction===b.Carousel.SlideByAction.previous){c.DOM.insertBefore(g[g.length-1],g[0],this.contentEl)}}else{if(this.currentCacheIndex===this.cache.images.length-2){if(this.lastSlideByAction===b.Carousel.SlideByAction.next){c.DOM.appendChild(g[0],this.contentEl)}}}}}}if(this.lastSlideByAction!==b.Carousel.SlideByAction.current){this.setContentLeftPosition();this.setImages(true)}c.Events.fire(this,{type:b.Carousel.EventTypes.onSlideByEnd,target:this,action:this.lastSlideByAction,cacheIndex:this.currentCacheIndex});if(this.isSlideshowActive){if(this.lastSlideByAction!==b.Carousel.SlideByAction.current){this.startSlideshow()}else{this.stopSlideshow()}}},onTouch:function(e,f){this.stopSlideshow();switch(e){case c.TouchElement.ActionTypes.touchStart:this.touchStartPoint=f;this.touchStartPosition={x:d.parseInt(c.DOM.getStyle(this.contentEl,"left"),0),y:d.parseInt(c.DOM.getStyle(this.contentEl,"top"),0)};break;case c.TouchElement.ActionTypes.touchMove:this.moveCarousel(f);break;case c.TouchElement.ActionTypes.touchMoveEnd:case c.TouchElement.ActionTypes.swipeLeft:case c.TouchElement.ActionTypes.swipeRight:this.slideCarousel(f,e);break;case c.TouchElement.ActionTypes.tap:break;case c.TouchElement.ActionTypes.doubleTap:break}},onImageLoad:function(g){var f=g.target;if(!c.isNothing(f.imageEl.parentNode)){c.DOM.removeClass(f.imageEl.parentNode,b.Carousel.CssClasses.itemLoading);this.resetImagePosition(f.imageEl)}c.Events.remove(f,b.Image.EventTypes.onLoad,this.imageLoadHandler);c.Events.remove(f,b.Image.EventTypes.onError,this.imageErrorHandler)},onImageError:function(g){var f=g.target;if(!c.isNothing(f.imageEl.parentNode)){c.DOM.removeClass(f.imageEl.parentNode,b.Carousel.CssClasses.itemLoading);c.DOM.addClass(f.imageEl.parentNode,b.Carousel.CssClasses.itemError)}c.Events.remove(f,b.Image.EventTypes.onLoad,this.imageLoadHandler);c.Events.remove(f,b.Image.EventTypes.onError,this.imageErrorHandler)}})}(window,window.klass,window.Code.Util));(function(e,a,d,c){d.registerNamespace("Code.PhotoSwipe.Carousel");var b=e.Code.PhotoSwipe;b.Carousel.CarouselClass=b.Carousel.CarouselClass.extend({getStartingPos:function(){var f=this.touchStartPosition;if(d.isNothing(f)){f={x:e.parseInt(d.DOM.getStyle(this.contentEl,"left"),0),y:e.parseInt(d.DOM.getStyle(this.contentEl,"top"),0)}}return f},doMoveCarousel:function(g){var f;if(d.Browser.isCSSTransformSupported){f={};f[d.Animation._transitionPrefix+"Property"]="all";f[d.Animation._transitionPrefix+"Duration"]="";f[d.Animation._transitionPrefix+"TimingFunction"]="";f[d.Animation._transitionPrefix+"Delay"]="0";f[d.Animation._transformLabel]=(d.Browser.is3dSupported)?"translate3d("+g+"px, 0px, 0px)":"translate("+g+"px, 0px)";d.DOM.setStyle(this.contentEl,f)}else{if(!d.isNothing(e.jQuery)){e.jQuery(this.contentEl).stop().css("left",this.getStartingPos().x+g+"px")}}},doSlideCarousel:function(i,g){var f,h;if(g<=0){this.slideByEndHandler();return}if(d.Browser.isCSSTransformSupported){h=d.coalesce(this.contentEl.style.webkitTransform,this.contentEl.style.MozTransform,this.contentEl.style.transform,"");if(h.indexOf("translate3d("+i)===0){this.slideByEndHandler();return}else{if(h.indexOf("translate("+i)===0){this.slideByEndHandler();return}}d.Animation.slideBy(this.contentEl,i,0,g,this.slideByEndHandler,this.settings.slideTimingFunction)}else{if(!d.isNothing(e.jQuery)){f={left:this.getStartingPos().x+i+"px"};if(this.settings.animationTimingFunction==="ease-out"){this.settings.animationTimingFunction="easeOutQuad"}if(d.isNothing(e.jQuery.easing[this.settings.animationTimingFunction])){this.settings.animationTimingFunction="linear"}e.jQuery(this.contentEl).animate(f,this.settings.slideSpeed,this.settings.animationTimingFunction,this.slideByEndHandler)}}}})}(window,window.klass,window.Code.Util,window.Code.PhotoSwipe.TouchElement));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Toolbar");var b=d.Code.PhotoSwipe;b.Toolbar.CssClasses={toolbar:"ps-toolbar",toolbarContent:"ps-toolbar-content",toolbarTop:"ps-toolbar-top",caption:"ps-caption",captionBottom:"ps-caption-bottom",captionContent:"ps-caption-content",close:"ps-toolbar-close",play:"ps-toolbar-play",previous:"ps-toolbar-previous",previousDisabled:"ps-toolbar-previous-disabled",next:"ps-toolbar-next",nextDisabled:"ps-toolbar-next-disabled"};b.Toolbar.ToolbarAction={close:"close",play:"play",next:"next",previous:"previous",none:"none"};b.Toolbar.EventTypes={onTap:"PhotoSwipeToolbarOnClick",onBeforeShow:"PhotoSwipeToolbarOnBeforeShow",onShow:"PhotoSwipeToolbarOnShow",onBeforeHide:"PhotoSwipeToolbarOnBeforeHide",onHide:"PhotoSwipeToolbarOnHide"};b.Toolbar.getToolbar=function(){return'<div class="'+b.Toolbar.CssClasses.close+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+'"></div></div><div class="'+b.Toolbar.CssClasses.play+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+'"></div></div><div class="'+b.Toolbar.CssClasses.previous+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+'"></div></div><div class="'+b.Toolbar.CssClasses.next+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+'"></div></div>'}}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.Toolbar");var b=d.Code.PhotoSwipe;b.Toolbar.ToolbarClass=a({toolbarEl:null,closeEl:null,playEl:null,previousEl:null,nextEl:null,captionEl:null,captionContentEl:null,currentCaption:null,settings:null,cache:null,timeout:null,isVisible:null,fadeOutHandler:null,touchStartHandler:null,touchMoveHandler:null,clickHandler:null,dispose:function(){var e;this.clearTimeout();this.removeEventHandlers();c.Animation.stop(this.toolbarEl);c.Animation.stop(this.captionEl);c.DOM.removeChild(this.toolbarEl,this.toolbarEl.parentNode);c.DOM.removeChild(this.captionEl,this.captionEl.parentNode);for(e in this){if(c.objectHasProperty(this,e)){this[e]=null}}},initialize:function(e,g){var f;this.settings=g;this.cache=e;this.isVisible=false;this.fadeOutHandler=this.onFadeOut.bind(this);this.touchStartHandler=this.onTouchStart.bind(this);this.touchMoveHandler=this.onTouchMove.bind(this);this.clickHandler=this.onClick.bind(this);f=b.Toolbar.CssClasses.toolbar;if(this.settings.captionAndToolbarFlipPosition){f=f+" "+b.Toolbar.CssClasses.toolbarTop}this.toolbarEl=c.DOM.createElement("div",{"class":f},this.settings.getToolbar());c.DOM.setStyle(this.toolbarEl,{left:0,position:"absolute",overflow:"hidden",zIndex:this.settings.zIndex});if(this.settings.target===d){c.DOM.appendToBody(this.toolbarEl)}else{c.DOM.appendChild(this.toolbarEl,this.settings.target)}c.DOM.hide(this.toolbarEl);this.closeEl=c.DOM.find("."+b.Toolbar.CssClasses.close,this.toolbarEl)[0];if(this.settings.preventHide&&!c.isNothing(this.closeEl)){c.DOM.hide(this.closeEl)}this.playEl=c.DOM.find("."+b.Toolbar.CssClasses.play,this.toolbarEl)[0];if(this.settings.preventSlideshow&&!c.isNothing(this.playEl)){c.DOM.hide(this.playEl)}this.nextEl=c.DOM.find("."+b.Toolbar.CssClasses.next,this.toolbarEl)[0];this.previousEl=c.DOM.find("."+b.Toolbar.CssClasses.previous,this.toolbarEl)[0];f=b.Toolbar.CssClasses.caption;if(this.settings.captionAndToolbarFlipPosition){f=f+" "+b.Toolbar.CssClasses.captionBottom}this.captionEl=c.DOM.createElement("div",{"class":f},"");c.DOM.setStyle(this.captionEl,{left:0,position:"absolute",overflow:"hidden",zIndex:this.settings.zIndex});if(this.settings.target===d){c.DOM.appendToBody(this.captionEl)}else{c.DOM.appendChild(this.captionEl,this.settings.target)}c.DOM.hide(this.captionEl);this.captionContentEl=c.DOM.createElement("div",{"class":b.Toolbar.CssClasses.captionContent},"");c.DOM.appendChild(this.captionContentEl,this.captionEl);this.addEventHandlers()},resetPosition:function(){var g,f,e;if(this.settings.target===d){if(this.settings.captionAndToolbarFlipPosition){f=c.DOM.windowScrollTop();e=(c.DOM.windowScrollTop()+c.DOM.windowHeight())-c.DOM.height(this.captionEl)}else{f=(c.DOM.windowScrollTop()+c.DOM.windowHeight())-c.DOM.height(this.toolbarEl);e=c.DOM.windowScrollTop()}g=c.DOM.windowWidth()}else{if(this.settings.captionAndToolbarFlipPosition){f="0";e=c.DOM.height(this.settings.target)-c.DOM.height(this.captionEl)}else{f=c.DOM.height(this.settings.target)-c.DOM.height(this.toolbarEl);e=0}g=c.DOM.width(this.settings.target)}c.DOM.setStyle(this.toolbarEl,{top:f+"px",width:g});c.DOM.setStyle(this.captionEl,{top:e+"px",width:g})},toggleVisibility:function(e){if(this.isVisible){this.fadeOut()}else{this.show(e)}},show:function(e){c.Animation.stop(this.toolbarEl);c.Animation.stop(this.captionEl);this.resetPosition();this.setToolbarStatus(e);c.Events.fire(this,{type:b.Toolbar.EventTypes.onBeforeShow,target:this});this.showToolbar();this.setCaption(e);this.showCaption();this.isVisible=true;this.setTimeout();c.Events.fire(this,{type:b.Toolbar.EventTypes.onShow,target:this})},setTimeout:function(){if(this.settings.captionAndToolbarAutoHideDelay>0){this.clearTimeout();this.timeout=d.setTimeout(this.fadeOut.bind(this),this.settings.captionAndToolbarAutoHideDelay)}},clearTimeout:function(){if(!c.isNothing(this.timeout)){d.clearTimeout(this.timeout);this.timeout=null}},fadeOut:function(){this.clearTimeout();c.Events.fire(this,{type:b.Toolbar.EventTypes.onBeforeHide,target:this});c.Animation.fadeOut(this.toolbarEl,this.settings.fadeOutSpeed);c.Animation.fadeOut(this.captionEl,this.settings.fadeOutSpeed,this.fadeOutHandler);this.isVisible=false},addEventHandlers:function(){if(c.Browser.isTouchSupported){if(!c.Browser.blackberry){c.Events.add(this.toolbarEl,"touchstart",this.touchStartHandler)}c.Events.add(this.toolbarEl,"touchmove",this.touchMoveHandler);c.Events.add(this.captionEl,"touchmove",this.touchMoveHandler)}c.Events.add(this.toolbarEl,"click",this.clickHandler)},removeEventHandlers:function(){if(c.Browser.isTouchSupported){if(!c.Browser.blackberry){c.Events.remove(this.toolbarEl,"touchstart",this.touchStartHandler)}c.Events.remove(this.toolbarEl,"touchmove",this.touchMoveHandler);c.Events.remove(this.captionEl,"touchmove",this.touchMoveHandler)}c.Events.remove(this.toolbarEl,"click",this.clickHandler)},handleTap:function(g){this.clearTimeout();var f;if(g.target===this.nextEl||c.DOM.isChildOf(g.target,this.nextEl)){f=b.Toolbar.ToolbarAction.next}else{if(g.target===this.previousEl||c.DOM.isChildOf(g.target,this.previousEl)){f=b.Toolbar.ToolbarAction.previous}else{if(g.target===this.closeEl||c.DOM.isChildOf(g.target,this.closeEl)){f=b.Toolbar.ToolbarAction.close}else{if(g.target===this.playEl||c.DOM.isChildOf(g.target,this.playEl)){f=b.Toolbar.ToolbarAction.play}}}}this.setTimeout();if(c.isNothing(f)){f=b.Toolbar.ToolbarAction.none}c.Events.fire(this,{type:b.Toolbar.EventTypes.onTap,target:this,action:f,tapTarget:g.target})},setCaption:function(e){c.DOM.removeChildren(this.captionContentEl);this.currentCaption=c.coalesce(this.cache.images[e].caption,"\u00A0");if(c.isObject(this.currentCaption)){c.DOM.appendChild(this.currentCaption,this.captionContentEl)}else{if(this.currentCaption===""){this.currentCaption="\u00A0"}c.DOM.appendText(this.currentCaption,this.captionContentEl)}this.currentCaption=(this.currentCaption==="\u00A0")?"":this.currentCaption;this.resetPosition()},showToolbar:function(){c.DOM.setStyle(this.toolbarEl,{opacity:this.settings.captionAndToolbarOpacity});c.DOM.show(this.toolbarEl)},showCaption:function(){if(this.currentCaption===""||this.captionContentEl.childNodes.length<1){if(!this.settings.captionAndToolbarShowEmptyCaptions){c.DOM.hide(this.captionEl);return}}c.DOM.setStyle(this.captionEl,{opacity:this.settings.captionAndToolbarOpacity});c.DOM.show(this.captionEl)},setToolbarStatus:function(e){if(this.settings.loop){return}c.DOM.removeClass(this.previousEl,b.Toolbar.CssClasses.previousDisabled);c.DOM.removeClass(this.nextEl,b.Toolbar.CssClasses.nextDisabled);if(e>0&&e<this.cache.images.length-1){return}if(e===0){if(!c.isNothing(this.previousEl)){c.DOM.addClass(this.previousEl,b.Toolbar.CssClasses.previousDisabled)}}if(e===this.cache.images.length-1){if(!c.isNothing(this.nextEl)){c.DOM.addClass(this.nextEl,b.Toolbar.CssClasses.nextDisabled)}}},onFadeOut:function(){c.DOM.hide(this.toolbarEl);c.DOM.hide(this.captionEl);c.Events.fire(this,{type:b.Toolbar.EventTypes.onHide,target:this})},onTouchStart:function(f){f.preventDefault();c.Events.remove(this.toolbarEl,"click",this.clickHandler);this.handleTap(f)},onTouchMove:function(f){f.preventDefault()},onClick:function(f){f.preventDefault();this.handleTap(f)}})}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.UILayer");var b=d.Code.PhotoSwipe;b.UILayer.CssClasses={uiLayer:"ps-uilayer"}}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.UILayer");var b=d.Code.PhotoSwipe;b.UILayer.UILayerClass=c.TouchElement.TouchElementClass.extend({el:null,settings:null,dispose:function(){var e;this.removeEventHandlers();c.DOM.removeChild(this.el,this.el.parentNode);for(e in this){if(c.objectHasProperty(this,e)){this[e]=null}}},initialize:function(e){this.settings=e;this.el=c.DOM.createElement("div",{"class":b.UILayer.CssClasses.uiLayer},"");c.DOM.setStyle(this.el,{display:"block",position:"absolute",left:0,top:0,overflow:"hidden",zIndex:this.settings.zIndex,opacity:0});c.DOM.hide(this.el);if(this.settings.target===d){c.DOM.appendToBody(this.el)}else{c.DOM.appendChild(this.el,this.settings.target)}this.supr(this.el,{swipe:true,move:true,gesture:c.Browser.iOS,doubleTap:true,preventDefaultTouchEvents:this.settings.preventDefaultTouchEvents})},resetPosition:function(){if(this.settings.target===d){c.DOM.setStyle(this.el,{top:c.DOM.windowScrollTop()+"px",width:c.DOM.windowWidth(),height:c.DOM.windowHeight()})}else{c.DOM.setStyle(this.el,{top:"0px",width:c.DOM.width(this.settings.target),height:c.DOM.height(this.settings.target)})}},show:function(){this.resetPosition();c.DOM.show(this.el);this.addEventHandlers()},addEventHandlers:function(){this.supr()},removeEventHandlers:function(){this.supr()}})}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.ZoomPanRotate");var b=d.Code.PhotoSwipe;b.ZoomPanRotate.CssClasses={zoomPanRotate:"ps-zoom-pan-rotate"};b.ZoomPanRotate.EventTypes={onTransform:"PhotoSwipeZoomPanRotateOnTransform"}}(window,window.klass,window.Code.Util));(function(d,a,c){c.registerNamespace("Code.PhotoSwipe.ZoomPanRotate");var b=d.Code.PhotoSwipe;b.ZoomPanRotate.ZoomPanRotateClass=a({el:null,settings:null,containerEl:null,imageEl:null,transformSettings:null,panStartingPoint:null,transformEl:null,dispose:function(){var e;c.DOM.removeChild(this.el,this.el.parentNode);for(e in this){if(c.objectHasProperty(this,e)){this[e]=null}}},initialize:function(g,e,j){var h,k,f,i;this.settings=g;if(this.settings.target===d){h=document.body;k=c.DOM.windowWidth();f=c.DOM.windowHeight();i=c.DOM.windowScrollTop()+"px"}else{h=this.settings.target;k=c.DOM.width(h);f=c.DOM.height(h);i="0px"}this.imageEl=e.imageEl.cloneNode(false);c.DOM.setStyle(this.imageEl,{zIndex:1});this.transformSettings={startingScale:1,scale:1,startingRotation:0,rotation:0,startingTranslateX:0,startingTranslateY:0,translateX:0,translateY:0};this.el=c.DOM.createElement("div",{"class":b.ZoomPanRotate.CssClasses.zoomPanRotate},"");c.DOM.setStyle(this.el,{left:0,top:i,position:"absolute",width:k,height:f,zIndex:this.settings.zIndex,display:"block"});c.DOM.insertBefore(this.el,j.el,h);if(c.Browser.iOS){this.containerEl=c.DOM.createElement("div","","");c.DOM.setStyle(this.containerEl,{left:0,top:0,width:k,height:f,position:"absolute",zIndex:1});c.DOM.appendChild(this.imageEl,this.containerEl);c.DOM.appendChild(this.containerEl,this.el);c.Animation.resetTranslate(this.containerEl);c.Animation.resetTranslate(this.imageEl);this.transformEl=this.containerEl}else{c.DOM.appendChild(this.imageEl,this.el);this.transformEl=this.imageEl}},setStartingTranslateFromCurrentTransform:function(){var f=c.coalesce(this.transformEl.style.webkitTransform,this.transformEl.style.MozTransform,this.transformEl.style.transform),e;if(!c.isNothing(f)){e=f.match(/translate\((.*?)\)/);if(!c.isNothing(e)){e=e[1].split(", ");this.transformSettings.startingTranslateX=d.parseInt(e[0],10);this.transformSettings.startingTranslateY=d.parseInt(e[1],10)}}},getScale:function(f){var e=this.transformSettings.startingScale*f;if(this.settings.minUserZoom!==0&&e<this.settings.minUserZoom){e=this.settings.minUserZoom}else{if(this.settings.maxUserZoom!==0&&e>this.settings.maxUserZoom){e=this.settings.maxUserZoom}}return e},setStartingScaleAndRotation:function(f,e){this.transformSettings.startingScale=this.getScale(f);this.transformSettings.startingRotation=(this.transformSettings.startingRotation+e)%360},zoomRotate:function(f,e){this.transformSettings.scale=this.getScale(f);this.transformSettings.rotation=this.transformSettings.startingRotation+e;this.applyTransform()},panStart:function(e){this.setStartingTranslateFromCurrentTransform();this.panStartingPoint={x:e.x,y:e.y}},pan:function(i){var e=i.x-this.panStartingPoint.x,g=i.y-this.panStartingPoint.y,f=e/this.transformSettings.scale,h=g/this.transformSettings.scale;this.transformSettings.translateX=this.transformSettings.startingTranslateX+f;this.transformSettings.translateY=this.transformSettings.startingTranslateY+h;this.applyTransform()},zoomAndPanToPoint:function(j,i){if(this.settings.target===d){this.panStart({x:c.DOM.windowWidth()/2,y:c.DOM.windowHeight()/2});var e=i.x-this.panStartingPoint.x,g=i.y-this.panStartingPoint.y,f=e/this.transformSettings.scale,h=g/this.transformSettings.scale;this.transformSettings.translateX=(this.transformSettings.startingTranslateX+f)*-1;this.transformSettings.translateY=(this.transformSettings.startingTranslateY+h)*-1}this.setStartingScaleAndRotation(j,0);this.transformSettings.scale=this.transformSettings.startingScale;this.transformSettings.rotation=0;this.applyTransform()},applyTransform:function(){var e=this.transformSettings.rotation%360,g=d.parseInt(this.transformSettings.translateX,10),h=d.parseInt(this.transformSettings.translateY,10),f="scale("+this.transformSettings.scale+") rotate("+e+"deg) translate("+g+"px, "+h+"px)";c.DOM.setStyle(this.transformEl,{webkitTransform:f,MozTransform:f,msTransform:f,transform:f});c.Events.fire(this,{target:this,type:b.ZoomPanRotate.EventTypes.onTransform,scale:this.transformSettings.scale,rotation:this.transformSettings.rotation,rotationDegs:e,translateX:g,translateY:h})}})}(window,window.klass,window.Code.Util));(function(c,b){b.registerNamespace("Code.PhotoSwipe");var a=c.Code.PhotoSwipe;a.CssClasses={buildingBody:"ps-building",activeBody:"ps-active"};a.EventTypes={onBeforeShow:"PhotoSwipeOnBeforeShow",onShow:"PhotoSwipeOnShow",onBeforeHide:"PhotoSwipeOnBeforeHide",onHide:"PhotoSwipeOnHide",onDisplayImage:"PhotoSwipeOnDisplayImage",onResetPosition:"PhotoSwipeOnResetPosition",onSlideshowStart:"PhotoSwipeOnSlideshowStart",onSlideshowStop:"PhotoSwipeOnSlideshowStop",onTouch:"PhotoSwipeOnTouch",onBeforeCaptionAndToolbarShow:"PhotoSwipeOnBeforeCaptionAndToolbarShow",onCaptionAndToolbarShow:"PhotoSwipeOnCaptionAndToolbarShow",onBeforeCaptionAndToolbarHide:"PhotoSwipeOnBeforeCaptionAndToolbarHide",onCaptionAndToolbarHide:"PhotoSwipeOnCaptionAndToolbarHide",onToolbarTap:"PhotoSwipeOnToolbarTap",onBeforeZoomPanRotateShow:"PhotoSwipeOnBeforeZoomPanRotateShow",onZoomPanRotateShow:"PhotoSwipeOnZoomPanRotateShow",onBeforeZoomPanRotateHide:"PhotoSwipeOnBeforeZoomPanRotateHide",onZoomPanRotateHide:"PhotoSwipeOnZoomPanRotateHide",onZoomPanRotateTransform:"PhotoSwipeOnZoomPanRotateTransform"};a.instances=[];a.activeInstances=[];a.setActivateInstance=function(e){var d=b.arrayIndexOf(e.settings.target,a.activeInstances,"target");if(d>-1){throw"Code.PhotoSwipe.activateInstance: Unable to active instance as another instance is already active for this target"}a.activeInstances.push({target:e.settings.target,instance:e})};a.unsetActivateInstance=function(e){var d=b.arrayIndexOf(e,a.activeInstances,"instance");a.activeInstances.splice(d,1)};a.attach=function(g,l,e){var d,k,h,f;h=a.createInstance(g,l,e);for(d=0,k=g.length;d<k;d++){f=g[d];if(!b.isNothing(f.nodeType)){if(f.nodeType===1){f.__photoSwipeClickHandler=a.onTriggerElementClick.bind(h);b.Events.remove(f,"click",f.__photoSwipeClickHandler);b.Events.add(f,"click",f.__photoSwipeClickHandler)}}}return h};if(c.jQuery){c.jQuery.fn.photoSwipe=function(e,d){return a.attach(this,e,d)}}a.detatch=function(f){var d,g,e;for(d=0,g=f.originalImages.length;d<g;d++){e=f.originalImages[d];if(!b.isNothing(e.nodeType)){if(e.nodeType===1){b.Events.remove(e,"click",e.__photoSwipeClickHandler);delete e.__photoSwipeClickHandler}}}a.disposeInstance(f)};a.createInstance=function(g,j,e){var d,h,f;if(b.isNothing(g)){throw"Code.PhotoSwipe.attach: No images passed."}if(!b.isLikeArray(g)){throw"Code.PhotoSwipe.createInstance: Images must be an array of elements or image urls."}if(g.length<1){throw"Code.PhotoSwipe.createInstance: No images to passed."}j=b.coalesce(j,{});h=a.getInstance(e);if(b.isNothing(h)){h=new a.PhotoSwipeClass(g,j,e);a.instances.push(h)}else{throw'Code.PhotoSwipe.createInstance: Instance with id "'+e+' already exists."'}return h};a.disposeInstance=function(d){var e=a.getInstanceIndex(d);if(e<0){throw"Code.PhotoSwipe.disposeInstance: Unable to find instance to dispose."}d.dispose();a.instances.splice(e,1);d=null};a.onTriggerElementClick=function(d){d.preventDefault();var f=this;f.show(d.currentTarget)};a.getInstance=function(e){var d,g,f;for(d=0,g=a.instances.length;d<g;d++){f=a.instances[d];if(f.id===e){return f}}return null};a.getInstanceIndex=function(e){var d,g,f=-1;for(d=0,g=a.instances.length;d<g;d++){if(a.instances[d]===e){f=d;break}}return f}}(window,window.Code.Util));(function(i,d,h,a,c,b,f,g,j){h.registerNamespace("Code.PhotoSwipe");var e=i.Code.PhotoSwipe;e.PhotoSwipeClass=d({id:null,settings:null,isBackEventSupported:null,backButtonClicked:null,currentIndex:null,originalImages:null,mouseWheelStartTime:null,windowDimensions:null,cache:null,documentOverlay:null,carousel:null,uiLayer:null,toolbar:null,zoomPanRotate:null,windowOrientationChangeHandler:null,windowScrollHandler:null,windowHashChangeHandler:null,keyDownHandler:null,windowOrientationEventName:null,uiLayerTouchHandler:null,carouselSlideByEndHandler:null,carouselSlideshowStartHandler:null,carouselSlideshowStopHandler:null,toolbarTapHandler:null,toolbarBeforeShowHandler:null,toolbarShowHandler:null,toolbarBeforeHideHandler:null,toolbarHideHandler:null,mouseWheelHandler:null,zoomPanRotateTransformHandler:null,_isResettingPosition:null,_uiWebViewResetPositionTimeout:null,dispose:function(){var k;h.Events.remove(this,e.EventTypes.onBeforeShow);h.Events.remove(this,e.EventTypes.onShow);h.Events.remove(this,e.EventTypes.onBeforeHide);h.Events.remove(this,e.EventTypes.onHide);h.Events.remove(this,e.EventTypes.onDisplayImage);h.Events.remove(this,e.EventTypes.onResetPosition);h.Events.remove(this,e.EventTypes.onSlideshowStart);h.Events.remove(this,e.EventTypes.onSlideshowStop);h.Events.remove(this,e.EventTypes.onTouch);h.Events.remove(this,e.EventTypes.onBeforeCaptionAndToolbarShow);h.Events.remove(this,e.EventTypes.onCaptionAndToolbarShow);h.Events.remove(this,e.EventTypes.onBeforeCaptionAndToolbarHide);h.Events.remove(this,e.EventTypes.onCaptionAndToolbarHide);h.Events.remove(this,e.EventTypes.onZoomPanRotateTransform);this.removeEventHandlers();if(!h.isNothing(this.documentOverlay)){this.documentOverlay.dispose()}if(!h.isNothing(this.carousel)){this.carousel.dispose()}if(!h.isNothing(this.uiLayer)){this.uiLayer.dispose()}if(!h.isNothing(this.toolbar)){this.toolbar.dispose()}this.destroyZoomPanRotate();if(!h.isNothing(this.cache)){this.cache.dispose()}for(k in this){if(h.objectHasProperty(this,k)){this[k]=null}}},initialize:function(l,m,k){var n;if(h.isNothing(k)){this.id="PhotoSwipe"+new Date().getTime().toString()}else{this.id=k}this.originalImages=l;if(h.Browser.android&&!h.Browser.firefox){if(i.navigator.userAgent.match(/Android (\d+.\d+)/).toString().replace(/^.*\,/,"")>=2.1){this.isBackEventSupported=true}}if(!this.isBackEventSupported){this.isBackEventSupported=h.objectHasProperty(i,"onhashchange")}this.settings={fadeInSpeed:250,fadeOutSpeed:250,preventHide:false,preventSlideshow:false,zIndex:1000,backButtonHideEnabled:true,enableKeyboard:true,enableMouseWheel:true,mouseWheelSpeed:350,autoStartSlideshow:false,jQueryMobile:(!h.isNothing(i.jQuery)&&!h.isNothing(i.jQuery.mobile)),jQueryMobileDialogHash:"&ui-state=dialog",enableUIWebViewRepositionTimeout:false,uiWebViewResetPositionDelay:500,target:i,preventDefaultTouchEvents:true,loop:true,slideSpeed:250,nextPreviousSlideSpeed:0,enableDrag:true,swipeThreshold:50,swipeTimeThreshold:250,slideTimingFunction:"ease-out",slideshowDelay:3000,doubleTapSpeed:250,margin:20,imageScaleMethod:"fit",captionAndToolbarHide:false,captionAndToolbarFlipPosition:false,captionAndToolbarAutoHideDelay:5000,captionAndToolbarOpacity:0.8,captionAndToolbarShowEmptyCaptions:true,getToolbar:e.Toolbar.getToolbar,allowUserZoom:true,allowRotationOnUserZoom:false,maxUserZoom:5,minUserZoom:0.5,doubleTapZoomLevel:2.5,getImageSource:e.Cache.Functions.getImageSource,getImageCaption:e.Cache.Functions.getImageCaption,getImageMetaData:e.Cache.Functions.getImageMetaData,cacheMode:e.Cache.Mode.normal};h.extend(this.settings,m);if(this.settings.target!==i){n=h.DOM.getStyle(this.settings.target,"position");if(n!=="relative"||n!=="absolute"){h.DOM.setStyle(this.settings.target,"position","relative")}}if(this.settings.target!==i){this.isBackEventSupported=false;this.settings.backButtonHideEnabled=false}else{if(this.settings.preventHide){this.settings.backButtonHideEnabled=false}}this.cache=new a.CacheClass(l,this.settings)},show:function(m){var k,l;this._isResettingPosition=false;this.backButtonClicked=false;if(h.isNumber(m)){this.currentIndex=m}else{this.currentIndex=-1;for(k=0,l=this.originalImages.length;k<l;k++){if(this.originalImages[k]===m){this.currentIndex=k;break}}}if(this.currentIndex<0||this.currentIndex>this.originalImages.length-1){throw"Code.PhotoSwipe.PhotoSwipeClass.show: Starting index out of range"}this.isAlreadyGettingPage=this.getWindowDimensions();e.setActivateInstance(this);this.windowDimensions=this.getWindowDimensions();if(this.settings.target===i){h.DOM.addClass(i.document.body,e.CssClasses.buildingBody)}else{h.DOM.addClass(this.settings.target,e.CssClasses.buildingBody)}this.createComponents();h.Events.fire(this,{type:e.EventTypes.onBeforeShow,target:this});this.documentOverlay.fadeIn(this.settings.fadeInSpeed,this.onDocumentOverlayFadeIn.bind(this))},getWindowDimensions:function(){return{width:h.DOM.windowWidth(),height:h.DOM.windowHeight()}},createComponents:function(){this.documentOverlay=new c.DocumentOverlayClass(this.settings);this.carousel=new b.CarouselClass(this.cache,this.settings);this.uiLayer=new g.UILayerClass(this.settings);if(!this.settings.captionAndToolbarHide){this.toolbar=new f.ToolbarClass(this.cache,this.settings)}},resetPosition:function(){if(this._isResettingPosition){return}var k=this.getWindowDimensions();if(!h.isNothing(this.windowDimensions)){if(k.width===this.windowDimensions.width&&k.height===this.windowDimensions.height){return}}this._isResettingPosition=true;this.windowDimensions=k;this.destroyZoomPanRotate();this.documentOverlay.resetPosition();this.carousel.resetPosition();if(!h.isNothing(this.toolbar)){this.toolbar.resetPosition()}this.uiLayer.resetPosition();this._isResettingPosition=false;h.Events.fire(this,{type:e.EventTypes.onResetPosition,target:this})},addEventHandler:function(l,k){h.Events.add(this,l,k)},addEventHandlers:function(){if(h.isNothing(this.windowOrientationChangeHandler)){this.windowOrientationChangeHandler=this.onWindowOrientationChange.bind(this);this.windowScrollHandler=this.onWindowScroll.bind(this);this.keyDownHandler=this.onKeyDown.bind(this);this.windowHashChangeHandler=this.onWindowHashChange.bind(this);this.uiLayerTouchHandler=this.onUILayerTouch.bind(this);this.carouselSlideByEndHandler=this.onCarouselSlideByEnd.bind(this);this.carouselSlideshowStartHandler=this.onCarouselSlideshowStart.bind(this);this.carouselSlideshowStopHandler=this.onCarouselSlideshowStop.bind(this);this.toolbarTapHandler=this.onToolbarTap.bind(this);this.toolbarBeforeShowHandler=this.onToolbarBeforeShow.bind(this);this.toolbarShowHandler=this.onToolbarShow.bind(this);this.toolbarBeforeHideHandler=this.onToolbarBeforeHide.bind(this);this.toolbarHideHandler=this.onToolbarHide.bind(this);this.mouseWheelHandler=this.onMouseWheel.bind(this);this.zoomPanRotateTransformHandler=this.onZoomPanRotateTransform.bind(this)}if(h.Browser.android){this.orientationEventName="resize"}else{if(h.Browser.iOS&&(!h.Browser.safari)){h.Events.add(i.document.body,"orientationchange",this.windowOrientationChangeHandler)}else{var k=!h.isNothing(i.onorientationchange);this.orientationEventName=k?"orientationchange":"resize"}}if(!h.isNothing(this.orientationEventName)){h.Events.add(i,this.orientationEventName,this.windowOrientationChangeHandler)}if(this.settings.target===i){h.Events.add(i,"scroll",this.windowScrollHandler)}if(this.settings.enableKeyboard){h.Events.add(i.document,"keydown",this.keyDownHandler)}if(this.isBackEventSupported&&this.settings.backButtonHideEnabled){this.windowHashChangeHandler=this.onWindowHashChange.bind(this);if(this.settings.jQueryMobile){i.location.hash=this.settings.jQueryMobileDialogHash}else{this.currentHistoryHashValue="PhotoSwipe"+new Date().getTime().toString();i.location.hash=this.currentHistoryHashValue}h.Events.add(i,"hashchange",this.windowHashChangeHandler)}if(this.settings.enableMouseWheel){h.Events.add(i,"mousewheel",this.mouseWheelHandler)}h.Events.add(this.uiLayer,h.TouchElement.EventTypes.onTouch,this.uiLayerTouchHandler);h.Events.add(this.carousel,b.EventTypes.onSlideByEnd,this.carouselSlideByEndHandler);h.Events.add(this.carousel,b.EventTypes.onSlideshowStart,this.carouselSlideshowStartHandler);h.Events.add(this.carousel,b.EventTypes.onSlideshowStop,this.carouselSlideshowStopHandler);if(!h.isNothing(this.toolbar)){h.Events.add(this.toolbar,f.EventTypes.onTap,this.toolbarTapHandler);h.Events.add(this.toolbar,f.EventTypes.onBeforeShow,this.toolbarBeforeShowHandler);h.Events.add(this.toolbar,f.EventTypes.onShow,this.toolbarShowHandler);h.Events.add(this.toolbar,f.EventTypes.onBeforeHide,this.toolbarBeforeHideHandler);h.Events.add(this.toolbar,f.EventTypes.onHide,this.toolbarHideHandler)}},removeEventHandlers:function(){if(h.Browser.iOS&&(!h.Browser.safari)){h.Events.remove(i.document.body,"orientationchange",this.windowOrientationChangeHandler)}if(!h.isNothing(this.orientationEventName)){h.Events.remove(i,this.orientationEventName,this.windowOrientationChangeHandler)}h.Events.remove(i,"scroll",this.windowScrollHandler);if(this.settings.enableKeyboard){h.Events.remove(i.document,"keydown",this.keyDownHandler)}if(this.isBackEventSupported&&this.settings.backButtonHideEnabled){h.Events.remove(i,"hashchange",this.windowHashChangeHandler)}if(this.settings.enableMouseWheel){h.Events.remove(i,"mousewheel",this.mouseWheelHandler)}if(!h.isNothing(this.uiLayer)){h.Events.remove(this.uiLayer,h.TouchElement.EventTypes.onTouch,this.uiLayerTouchHandler)}if(!h.isNothing(this.toolbar)){h.Events.remove(this.carousel,b.EventTypes.onSlideByEnd,this.carouselSlideByEndHandler);h.Events.remove(this.carousel,b.EventTypes.onSlideshowStart,this.carouselSlideshowStartHandler);h.Events.remove(this.carousel,b.EventTypes.onSlideshowStop,this.carouselSlideshowStopHandler)}if(!h.isNothing(this.toolbar)){h.Events.remove(this.toolbar,f.EventTypes.onTap,this.toolbarTapHandler);h.Events.remove(this.toolbar,f.EventTypes.onBeforeShow,this.toolbarBeforeShowHandler);h.Events.remove(this.toolbar,f.EventTypes.onShow,this.toolbarShowHandler);h.Events.remove(this.toolbar,f.EventTypes.onBeforeHide,this.toolbarBeforeHideHandler);h.Events.remove(this.toolbar,f.EventTypes.onHide,this.toolbarHideHandler)}},hide:function(){if(this.settings.preventHide){return}if(h.isNothing(this.documentOverlay)){throw"Code.PhotoSwipe.PhotoSwipeClass.hide: PhotoSwipe instance is already hidden"}if(!h.isNothing(this.hiding)){return}this.clearUIWebViewResetPositionTimeout();this.destroyZoomPanRotate();this.removeEventHandlers();h.Events.fire(this,{type:e.EventTypes.onBeforeHide,target:this});this.uiLayer.dispose();this.uiLayer=null;if(!h.isNothing(this.toolbar)){this.toolbar.dispose();this.toolbar=null}this.carousel.dispose();this.carousel=null;h.DOM.removeClass(i.document.body,e.CssClasses.activeBody);this.documentOverlay.dispose();this.documentOverlay=null;this._isResettingPosition=false;e.unsetActivateInstance(this);h.Events.fire(this,{type:e.EventTypes.onHide,target:this});this.goBackInHistory()},goBackInHistory:function(){if(this.isBackEventSupported&&this.settings.backButtonHideEnabled){if(!this.backButtonClicked){i.history.back()}}},play:function(){if(this.isZoomActive()){return}if(!this.settings.preventSlideshow){if(!h.isNothing(this.carousel)){if(!h.isNothing(this.toolbar)&&this.toolbar.isVisible){this.toolbar.fadeOut()}this.carousel.startSlideshow()}}},stop:function(){if(this.isZoomActive()){return}if(!h.isNothing(this.carousel)){this.carousel.stopSlideshow()}},previous:function(){if(this.isZoomActive()){return}if(!h.isNothing(this.carousel)){this.carousel.previous()}},next:function(){if(this.isZoomActive()){return}if(!h.isNothing(this.carousel)){this.carousel.next()}},toggleToolbar:function(){if(this.isZoomActive()){return}if(!h.isNothing(this.toolbar)){this.toolbar.toggleVisibility(this.currentIndex)}},fadeOutToolbarIfVisible:function(){if(!h.isNothing(this.toolbar)&&this.toolbar.isVisible&&this.settings.captionAndToolbarAutoHideDelay>0){this.toolbar.fadeOut()}},createZoomPanRotate:function(){this.stop();if(this.canUserZoom()&&!this.isZoomActive()){h.Events.fire(this,e.EventTypes.onBeforeZoomPanRotateShow);this.zoomPanRotate=new j.ZoomPanRotateClass(this.settings,this.cache.images[this.currentIndex],this.uiLayer);this.uiLayer.captureSettings.preventDefaultTouchEvents=true;h.Events.add(this.zoomPanRotate,e.ZoomPanRotate.EventTypes.onTransform,this.zoomPanRotateTransformHandler);h.Events.fire(this,e.EventTypes.onZoomPanRotateShow);if(!h.isNothing(this.toolbar)&&this.toolbar.isVisible){this.toolbar.fadeOut()}}},destroyZoomPanRotate:function(){if(!h.isNothing(this.zoomPanRotate)){h.Events.fire(this,e.EventTypes.onBeforeZoomPanRotateHide);h.Events.remove(this.zoomPanRotate,e.ZoomPanRotate.EventTypes.onTransform,this.zoomPanRotateTransformHandler);this.zoomPanRotate.dispose();this.zoomPanRotate=null;this.uiLayer.captureSettings.preventDefaultTouchEvents=this.settings.preventDefaultTouchEvents;h.Events.fire(this,e.EventTypes.onZoomPanRotateHide)}},canUserZoom:function(){var l,k;if(h.Browser.msie){l=document.createElement("div");if(h.isNothing(l.style.msTransform)){return false}}else{if(!h.Browser.isCSSTransformSupported){return false}}if(!this.settings.allowUserZoom){return false}if(this.carousel.isSliding){return false}k=this.cache.images[this.currentIndex];if(h.isNothing(k)){return false}if(k.isLoading){return false}return true},isZoomActive:function(){return(!h.isNothing(this.zoomPanRotate))},getCurrentImage:function(){return this.cache.images[this.currentIndex]},onDocumentOverlayFadeIn:function(k){i.setTimeout(function(){var l=(this.settings.target===i)?i.document.body:this.settings.target;h.DOM.removeClass(l,e.CssClasses.buildingBody);h.DOM.addClass(l,e.CssClasses.activeBody);this.addEventHandlers();this.carousel.show(this.currentIndex);this.uiLayer.show();if(this.settings.autoStartSlideshow){this.play()}else{if(!h.isNothing(this.toolbar)){this.toolbar.show(this.currentIndex)}}h.Events.fire(this,{type:e.EventTypes.onShow,target:this});this.setUIWebViewResetPositionTimeout()}.bind(this),250)},setUIWebViewResetPositionTimeout:function(){if(!this.settings.enableUIWebViewRepositionTimeout){return}if(!(h.Browser.iOS&&(!h.Browser.safari))){return}if(!h.isNothing(this._uiWebViewResetPositionTimeout)){i.clearTimeout(this._uiWebViewResetPositionTimeout)}this._uiWebViewResetPositionTimeout=i.setTimeout(function(){this.resetPosition();this.setUIWebViewResetPositionTimeout()}.bind(this),this.settings.uiWebViewResetPositionDelay)},clearUIWebViewResetPositionTimeout:function(){if(!h.isNothing(this._uiWebViewResetPositionTimeout)){i.clearTimeout(this._uiWebViewResetPositionTimeout)}},onWindowScroll:function(k){this.resetPosition()},onWindowOrientationChange:function(k){this.resetPosition()},onWindowHashChange:function(l){var k="#"+((this.settings.jQueryMobile)?this.settings.jQueryMobileDialogHash:this.currentHistoryHashValue);if(i.location.hash!==k){this.backButtonClicked=true;this.hide()}},onKeyDown:function(k){if(k.keyCode===37){k.preventDefault();this.previous()}else{if(k.keyCode===39){k.preventDefault();this.next()}else{if(k.keyCode===38||k.keyCode===40){k.preventDefault()}else{if(k.keyCode===27){k.preventDefault();this.hide()}else{if(k.keyCode===32){if(!this.settings.hideToolbar){this.toggleToolbar()}else{this.hide()}k.preventDefault()}else{if(k.keyCode===13){k.preventDefault();this.play()}}}}}}},onUILayerTouch:function(l){if(this.isZoomActive()){switch(l.action){case h.TouchElement.ActionTypes.gestureChange:this.zoomPanRotate.zoomRotate(l.scale,(this.settings.allowRotationOnUserZoom)?l.rotation:0);break;case h.TouchElement.ActionTypes.gestureEnd:this.zoomPanRotate.setStartingScaleAndRotation(l.scale,(this.settings.allowRotationOnUserZoom)?l.rotation:0);break;case h.TouchElement.ActionTypes.touchStart:this.zoomPanRotate.panStart(l.point);break;case h.TouchElement.ActionTypes.touchMove:this.zoomPanRotate.pan(l.point);break;case h.TouchElement.ActionTypes.doubleTap:this.destroyZoomPanRotate();this.toggleToolbar();break;case h.TouchElement.ActionTypes.swipeLeft:this.destroyZoomPanRotate();this.next();this.toggleToolbar();break;case h.TouchElement.ActionTypes.swipeRight:this.destroyZoomPanRotate();this.previous();this.toggleToolbar();break}}else{switch(l.action){case h.TouchElement.ActionTypes.touchMove:case h.TouchElement.ActionTypes.swipeLeft:case h.TouchElement.ActionTypes.swipeRight:this.fadeOutToolbarIfVisible();this.carousel.onTouch(l.action,l.point);break;case h.TouchElement.ActionTypes.touchStart:case h.TouchElement.ActionTypes.touchMoveEnd:this.carousel.onTouch(l.action,l.point);break;case h.TouchElement.ActionTypes.tap:this.toggleToolbar();break;case h.TouchElement.ActionTypes.doubleTap:if(this.settings.target===i){l.point.x-=h.DOM.windowScrollLeft();l.point.y-=h.DOM.windowScrollTop()}var k=this.cache.images[this.currentIndex].imageEl,p=i.parseInt(h.DOM.getStyle(k,"top"),10),n=i.parseInt(h.DOM.getStyle(k,"left"),10),o=n+h.DOM.width(k),m=p+h.DOM.height(k);if(l.point.x<n){l.point.x=n}else{if(l.point.x>o){l.point.x=o}}if(l.point.y<p){l.point.y=p}else{if(l.point.y>m){l.point.y=m}}this.createZoomPanRotate();if(this.isZoomActive()){this.zoomPanRotate.zoomAndPanToPoint(this.settings.doubleTapZoomLevel,l.point)}break;case h.TouchElement.ActionTypes.gestureStart:this.createZoomPanRotate();break}}h.Events.fire(this,{type:e.EventTypes.onTouch,target:this,point:l.point,action:l.action})},onCarouselSlideByEnd:function(k){this.currentIndex=k.cacheIndex;if(!h.isNothing(this.toolbar)){this.toolbar.setCaption(this.currentIndex);this.toolbar.setToolbarStatus(this.currentIndex)}h.Events.fire(this,{type:e.EventTypes.onDisplayImage,target:this,action:k.action,index:k.cacheIndex})},onToolbarTap:function(k){switch(k.action){case f.ToolbarAction.next:this.next();break;case f.ToolbarAction.previous:this.previous();break;case f.ToolbarAction.close:this.hide();break;case f.ToolbarAction.play:this.play();break}h.Events.fire(this,{type:e.EventTypes.onToolbarTap,target:this,toolbarAction:k.action,tapTarget:k.tapTarget})},onMouseWheel:function(m){var k=h.Events.getWheelDelta(m),l=m.timeStamp-(this.mouseWheelStartTime||0);if(l<this.settings.mouseWheelSpeed){return}this.mouseWheelStartTime=m.timeStamp;if(this.settings.invertMouseWheel){k=k*-1}if(k<0){this.next()}else{if(k>0){this.previous()}}},onCarouselSlideshowStart:function(k){h.Events.fire(this,{type:e.EventTypes.onSlideshowStart,target:this})},onCarouselSlideshowStop:function(k){h.Events.fire(this,{type:e.EventTypes.onSlideshowStop,target:this})},onToolbarBeforeShow:function(k){h.Events.fire(this,{type:e.EventTypes.onBeforeCaptionAndToolbarShow,target:this})},onToolbarShow:function(k){h.Events.fire(this,{type:e.EventTypes.onCaptionAndToolbarShow,target:this})},onToolbarBeforeHide:function(k){h.Events.fire(this,{type:e.EventTypes.onBeforeCaptionAndToolbarHide,target:this})},onToolbarHide:function(k){h.Events.fire(this,{type:e.EventTypes.onCaptionAndToolbarHide,target:this})},onZoomPanRotateTransform:function(k){h.Events.fire(this,{target:this,type:e.EventTypes.onZoomPanRotateTransform,scale:k.scale,rotation:k.rotation,rotationDegs:k.rotationDegs,translateX:k.translateX,translateY:k.translateY})}})}(window,window.klass,window.Code.Util,window.Code.PhotoSwipe.Cache,window.Code.PhotoSwipe.DocumentOverlay,window.Code.PhotoSwipe.Carousel,window.Code.PhotoSwipe.Toolbar,window.Code.PhotoSwipe.UILayer,window.Code.PhotoSwipe.ZoomPanRotate));