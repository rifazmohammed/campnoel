(function(a){a.fn.adGallery=function(k){var i={loader_image:"/aspx/Shared/images/loader.gif",start_at_index:0,thumb_opacity:0.7,animate_first_image:false,animation_speed:100,width:false,height:false,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:561,slideshow:{enable:true,autostart:false,speed:500,start_label:"Start",stop_label:"Stop",stop_on_scroll:true,countdown_prefix:"(",countdown_sufix:")",onStart:false,onStop:false},effect:"fade",enable_keyboard_move:false,cycle:false,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var l=a.extend(false,i,k);if(k&&k.slideshow){l.slideshow=a.extend(false,i.slideshow,k.slideshow)}if(!l.slideshow.enable){l.slideshow.autostart=false}var j=[];a(this).each(function(){var m=new b(this,l);j[j.length]=m});return j};function h(l,k,j){var i=parseInt(l.css("top"),10);if(k=="left"){var m="-"+this.image_wrapper_height+"px";l.css("top",this.image_wrapper_height+"px")}else{var m=this.image_wrapper_height+"px";l.css("top","-"+this.image_wrapper_height+"px")}if(j){j.css("bottom","-"+j[0].offsetHeight+"px");j.animate({bottom:0},this.settings.animation_speed*2)}return{old_image:{top:m},new_image:{top:i}}}function e(l,k,j){var i=parseInt(l.css("left"),10);if(k=="left"){var m="-"+this.image_wrapper_width+"px";l.css("left",this.image_wrapper_width+"px")}else{var m=this.image_wrapper_width+"px";l.css("left","-"+this.image_wrapper_width+"px")}if(j){j.css("bottom","-"+j[0].offsetHeight+"px");j.animate({bottom:0},this.settings.animation_speed*2)}return{old_image:{left:m},new_image:{left:i}}}function g(o,l,k){var n=o.width();var m=o.height();var i=parseInt(o.css("left"),10);var j=parseInt(o.css("top"),10);o.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:n,height:m,top:j,left:i}}}function d(k,j,i){k.css("opacity",1);return{old_image:{opacity:1},new_image:{opacity:1}}}function f(k,j,i){k.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function b(j,i){this.init(j,i)}b.prototype={wrapper:false,image_wrapper:false,description_wrapper:false,navigator_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(m,k){var i=this;this.wrapper=a(m);this.settings=k;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width)}else{this.image_wrapper_width=this.image_wrapper.width()}if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height)}else{this.image_wrapper_height=this.image_wrapper.height()}this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev){this.initNextAndPrev()}var j=function(n){return i.nextImage(n)};this.slideshow=new c(j,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable){this.slideshow.enable()}else{this.slideshow.disable()}if(this.settings.display_back_and_forward){this.initBackAndForward()}if(this.settings.enable_keyboard_move){this.initKeyEvents()}var l=this.settings.start_at_index;if(window.location.hash&&window.location.hash.indexOf("#")===0){l=parseInt(window.location.hash.replace(/[^0-9]+/g,""))-1;if((l*1)!=l||l<1||l>this.images.length){l=parseInt(this.settings.start_at_index)}}if(this.current_index!=false){a("#fullscreen").attr("href",this.images[this.current_index].image.replace(/#.*/,""))}this.loading(true);this.showImage(l,function(){if(i.settings.slideshow.autostart){i.preloadImage(l+1);i.slideshow.start()}});this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":h,"slide-hori":e,resize:g,fade:d,none:f}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls");this.gallery_info=this.controls.find(".ad-info");this.image_wrapper=this.wrapper.find(".ad-image-wrapper");this.image_wrapper.empty();this.description_wrapper=this.wrapper.find(".ad-image-description");this.navigator_wrapper=this.wrapper.find(".ad-navigator-wrapper");this.description_wrapper.empty();this.nav=this.wrapper.find(".ad-nav");this.thumbs_wrapper=this.nav.find(".ad-thumbs");this.preloads=a('<div class="ad-preloads"></div>');this.loader=a('<img class="ad-loader" src="'+this.settings.loader_image+'">');this.image_wrapper.append(this.loader);this.loader.hide();a(document.body).append(this.preloads)},loading:function(i){if(i){this.loader.show()}else{this.loader.hide()}},addAnimation:function(j,i){if(a.isFunction(i)){this.animations[j]=i}},findImages:function(){var i=this;this.images=[];var k=0;var m=0;var l=this.thumbs_wrapper.find("a");var j=l.length;if(this.settings.thumb_opacity<1){l.find("img").css("opacity",this.settings.thumb_opacity)}l.each(function(o){var r=a(this);var q=r.attr("href");var p=r.attr("org");var t=r.find("img");if(t.length>0){if(!i.isImageLoaded(t[0])){t.load(function(){k+=this.parentNode.parentNode.offsetWidth;m++})}else{k+=t[0].parentNode.parentNode.offsetWidth;m++}}r.addClass("ad-thumb"+o);var v=a("<span class='tooltips' id='descrp'><b>"+r.find("img").attr("title")+"<i></i></b></span>");r.click(function(){i.slideshow.stop();return false}).hover(function(){a(this).find("img").attr("title","");a("body").append(v);v.css("left",a(this).offset().left-v.outerWidth(false)/2+25);v.css("top",a(this).offset().top+48);v.find("i").css("left",v.innerWidth()/2-5);v.show();if(!a(this).is(".ad-active")&&i.settings.thumb_opacity<1){a(this).find("img").fadeTo(300,1)}i.preloadImage(o)},function(){a("body span.tooltips").hide().remove();if(!a(this).is(".ad-active")&&i.settings.thumb_opacity<1){a(this).find("img").fadeTo(300,i.settings.thumb_opacity)}});var n=false;if(t.data("ad-desc")){n=t.data("ad-desc")}else{if(t.attr("longdesc")&&t.attr("longdesc").length){n=t.attr("longdesc")}}var u=false;if(t.data("ad-title")){u=t.data("ad-title")}else{if(t.attr("title")&&t.attr("title").length){u=t.attr("title")}}var s=false;if(t.data("segment_id")){s=t.data("segment_id")}else{if(t.attr("segment_id")&&t.attr("segment_id").length){s=t.attr("segment_id")}}i.images[o]={thumb:t.attr("src"),image:q,org:p,error:false,preloaded:false,desc:n,title:u,size:false,segment_id:s}});i.nav.find(".ad-thumb-list").css("width",l.length*57)},initKeyEvents:function(){var i=this;a(document).keydown(function(j){if(j.keyCode==39){i.nextImage();i.slideshow.stop()}else{if(j.keyCode==37){i.prevImage();i.slideshow.stop()}}})},initNextAndPrev:function(){var i=this;this.next_link=a('<div class="ad-next" rel="history"><div class="ad-next-image"></div></div>');this.prev_link=a('<div class="ad-prev" rel="history"><div class="ad-prev-image"></div></div>');this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);if(i.images.length==0){i.prev_link.children("div").addClass("ad-next-image-gray");i.next_link.children("div").addClass("ad-prev-image-gray");a("#fullscreen").css("opacity",0.3)}else{this.prev_link.add(this.next_link).click(function(){if(a(this).is(".ad-next")){i.slideshow.stop();if(i.nextIndex()==false){i.next_link.attr("hash",i.images[i.current_index].image.replace(/.*#/,""))}else{i.next_link.attr("hash",i.images[i.nextIndex()].image.replace(/.*#/,""))}}else{i.slideshow.stop();if(i.prevIndex()==false){i.prev_link.attr("hash",i.images[0].image.replace(/.*#/,""))}else{i.prev_link.attr("hash",i.images[i.prevIndex()].image.replace(/.*#/,""))}}})}},initBackAndForward:function(){var i=this;this.scroll_forward=a(".ad-gallery .ad-nav .ad-forward");this.scroll_back=a(".ad-gallery .ad-nav .ad-back");var j=0;var m=false;var k=i.thumbs_wrapper.scrollLeft();var l=i.thumbs_wrapper[0].scrollWidth-i.thumbs_wrapper.scrollLeft()-579;if(k==0&&l>0){i.scroll_forward.removeClass("dont ad-forward-gray");i.scroll_back.addClass("dont ad-back-gray")}else{if(l==0&&k>0){i.scroll_forward.addClass("dont ad-forward-gray");i.scroll_back.removeClass("dont ad-back-gray")}else{if(l==0&&k==0){i.scroll_forward.addClass("dont ad-forward-gray");i.scroll_back.addClass("dont ad-back-gray")}else{i.scroll_forward.removeClass("dont ad-forward-gray");i.scroll_back.removeClass("dont ad-back-gray")}}}a(this.scroll_back).add(this.scroll_forward).click(function(){var o=i.nav_display_width-50;if(i.settings.scroll_jump>0){var o=i.settings.scroll_jump}if(a(this).is(".ad-forward")){var n=i.thumbs_wrapper.scrollLeft()+o}else{var n=i.thumbs_wrapper.scrollLeft()-o}if(i.settings.slideshow.stop_on_scroll){i.slideshow.stop()}i.thumbs_wrapper.animate({scrollLeft:n+"px"},"normal",function(){var p=i.thumbs_wrapper.scrollLeft();var q=i.thumbs_wrapper[0].scrollWidth-i.thumbs_wrapper.scrollLeft()-579;if(p==0&&q>0){i.scroll_forward.removeClass("dont ad-forward-gray");i.scroll_back.addClass("dont ad-back-gray")}else{if(q==0&&p>0){i.scroll_forward.addClass("dont ad-forward-gray");i.scroll_back.removeClass("dont ad-back-gray")}else{if(q==0&&p==0){i.scroll_forward.addClass("dont ad-forward-gray");i.scroll_back.addClass("dont ad-back-gray")}else{i.scroll_forward.removeClass("dont ad-forward-gray");i.scroll_back.removeClass("dont ad-back-gray")}}}});return false}).hover(function(){return;var n="left";if(a(this).is(".ad-forward")){n="right"}m=setInterval(function(){j++;if(j>30&&i.settings.slideshow.stop_on_scroll){i.slideshow.stop()}var o=i.thumbs_wrapper.scrollLeft()+1;if(n=="left"){o=i.thumbs_wrapper.scrollLeft()-1}i.thumbs_wrapper.scrollLeft(o)},10);a(this).css("opacity",1)},function(){j=0;clearInterval(m)})},_afterShow:function(){this.gallery_info.html((this.current_index+1)+" / "+this.images.length);if(!this.settings.cycle){this.prev_link.children("div").removeClass("ad-prev-image-gray");this.next_link.children("div").removeClass("ad-next-image-gray");if(this.current_index==(this.images.length-1)){this.next_link.children("div").addClass("ad-next-image-gray")}if(this.current_index==0){this.prev_link.children("div").addClass("ad-prev-image-gray")}}a("#getlink").attr("link",window.location.href.replace(window.location.hash,"")+"#"+(this.current_index+1));a(".ad-navigator-wrapper").attr("org",this.images[this.current_index].org);this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(j,i){if(i>this.image_wrapper_height){var k=j/i;i=this.image_wrapper_height;j=this.image_wrapper_height*k}if(j>this.image_wrapper_width){var k=i/j;j=this.image_wrapper_width;i=this.image_wrapper_width*k}return{width:j,height:i}},_centerImage:function(l,k,j){l.css("top","0px");if(j<this.image_wrapper_height){var i=this.image_wrapper_height-j;l.css("top",(i/2)+"px")}l.css("left","0px");if(k<this.image_wrapper_width){var i=this.image_wrapper_width-k;l.css("left",(i/2)+"px")}},_getDescription:function(j){var i=false;if(j.desc.length||j.title.length){var k="";if(j.title.length){k='<strong class="ad-description-title">'+j.title+"</strong>"}var i="";if(j.desc.length){i="<span>"+j.desc+"</span>"}i=a('<p class="ad-image-description">'+k+i+"</p>")}return i},showImage:function(l,i){if(this.images[l]&&!this.in_transition){var j=this;var k=this.images[l];this.in_transition=true;if(!k.preloaded){this.loading(true);this.preloadImage(l,function(){j.loading(false);j._showWhenLoaded(l,i)})}else{this._showWhenLoaded(l,i)}}},_showWhenLoaded:function(v,k){if(this.images[v]){var m=this;var r=this.images[v];a("#currentImage").parent().remove();var t=a(document.createElement("div")).addClass("ad-image bor4");var l=r.image.replace(/#.*/,"").replace(imgserver,cdnserver);var u=l.replace(cdnserver,imgserver);var s=a(new Image());s.attr("src",l);s.attr("altsrc",u);s.on("error",function(){imageError(this)});s.attr("id","currentImage");s.attr("org",r.org);t.append(s);a(".ad-navigator-wrapper").mouseover(function(){a(this).stop(true,false)}).click(function(){a(this).animate({opacity:0},200)});this.image_wrapper.prepend(t);var x=this._getContainedImageSize(r.size.width,r.size.height);s.css("width",x.width);s.css("height",x.height);this._centerImage(t,x.width,x.height);var n=this._getDescription(r,t);if(n){try{var y=x.width-parseInt(n.css("padding-left"),10)-parseInt(n.css("padding-right"),10);n.css("width",y+"px");this.description_wrapper.empty();this.description_wrapper.prepend(n)}catch(p){}}this.highLightThumb(this.nav.find(".ad-thumb"+v));var o="right";if(this.current_index<v){o="left"}this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var j=this.settings.animation_speed;var q="swing";var i=this.animations[this.settings.effect].call(this,t,o,n);if(typeof i.speed!="undefined"){j=i.speed}if(typeof i.easing!="undefined"){q=i.easing}if(this.current_image){var w=this.current_image;w.animate(i.old_image,j,q,function(){w.remove()})}t.animate(i.new_image,j,q,function(){m.current_index=v;m.current_image=t;m.in_transition=false;m._afterShow();m.fireCallback(k)})}else{this.current_index=v;this.current_image=t;this.in_transition=false;m._afterShow();this.fireCallback(k)}}},nextIndex:function(){if(this.current_index==(this.images.length-1)){if(!this.settings.cycle){return false}var i=0}else{var i=this.current_index+1}return i},nextImage:function(i){var j=this.nextIndex();if(j===false){return false}this.preloadImage(j+1);this.showImage(j,i);return true},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle){return false}var i=this.images.length-1}else{var i=this.current_index-1}return i},prevImage:function(i){var j=this.prevIndex();if(j===false){return false}this.preloadImage(j-1);this.showImage(j,i);return true},preloadAll:function(){var j=this;var k=0;function l(){if(k<j.images.length){k++;j.preloadImage(k,l)}}j.preloadImage(k,l)},preloadImage:function(o,i){if(this.images[o]){var l=this.images[o];if(!this.images[o].preloaded){var j=l.image.replace(/#.*/,"").replace(imgserver,cdnserver);var n=j.replace(cdnserver,imgserver);var m=a(new Image());m.attr("src",j);m.attr("altsrc",n);m.on("error",function(){imageError(this)});if(!this.isImageLoaded(m[0])){this.preloads.append(m);var k=this;m.load(function(){l.error=false;l.preloaded=true;var p=this.height;if(this.height==0){p=this.clientHeight;if(p==0){p=this.scrollHeight}}l.size={width:this.width,height:p};k.fireCallback(i)}).error(function(){l.error=true;l.preloaded=false;l.size={width:"1",height:"1"};k.fireCallback(i)})}else{l.preloaded=true;l.size={width:m[0].width,height:m[0].height};this.fireCallback(i)}}else{this.fireCallback(i)}}},isImageLoaded:function(i){if(typeof i!="undefined"&&typeof i.complete!="undefined"&&!i.complete){return false}if(typeof i!="undefined"&&typeof i.naturalWidth!="undefined"&&i.naturalWidth==0){return false}return true},highLightThumb:function(j){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active");j.addClass("ad-active");if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity);j.find("img").fadeTo(300,1)}var i=j[0].parentNode.offsetLeft;i-=(this.nav_display_width/2)-(j[0].offsetWidth/2);this.thumbs_wrapper.animate({scrollLeft:i+"px"})},fireCallback:function(i){if(a.isFunction(i)){i.call(this)}}};function c(i,j){this.init(i,j)}c.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(j,k){var i=this;this.nextimage_callback=j;this.settings=k},create:function(){this.start_link=a('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>");this.stop_link=a('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>");this.countdown=a('<span class="ad-slideshow-countdown"></span>');this.controls=a('<p class="ad-slideshow-controls"></p>');this.controls.append(this.start_link).append(this.stop_link).append(this.countdown);this.countdown.hide();var i=this;this.start_link.click(function(){i.start()});this.stop_link.click(function(){i.stop()});a(document).keydown(function(j){if(j.keyCode==83){if(i.running){i.stop()}else{i.start()}}});return this.controls},disable:function(){this.enabled=false;this.stop();this.controls.hide()},enable:function(){this.enabled=true;this.controls.show()},toggle:function(){if(this.enabled){this.disable()}else{this.enable()}},start:function(){if(this.running||!this.enabled){return false}var i=this;this.running=true;this.controls.addClass("ad-slideshow-running");this._next();this.fireCallback(this.settings.onStart);return true},stop:function(){if(!this.running){return false}this.running=false;this.countdown.hide();this.controls.removeClass("ad-slideshow-running");clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true},_next:function(){var i=this;var j=this.settings.countdown_prefix;var l=this.settings.countdown_sufix;clearInterval(i.countdown_interval);this.countdown.show().html(j+(this.settings.speed/1000)+l);var k=0;this.countdown_interval=setInterval(function(){k+=1000;if(k>=i.settings.speed){var n=function(){if(i.running){i._next()}k=0};if(!i.nextimage_callback(n)){i.stop()}k=0}var m=parseInt(i.countdown.text().replace(/[^0-9]/g,""),10);m--;if(m>0){i.countdown.html(j+m+l)}},1000)},fireCallback:function(i){if(a.isFunction(i)){i.call(this)}}}})(jQuery);