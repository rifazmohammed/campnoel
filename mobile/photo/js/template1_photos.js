$.historyInit(loadAlbum,"history.html");function loadAlbum(hash){if(hash==""||typeof hash=="undefined"){hash="0_1"}var albumID=parseInt(hash.replace(/_.*/,""));var imageIndex=parseInt(hash.replace(/.*_/,""));if(isNaN(imageIndex)){imageIndex=1}if(currentAlbumID==albumID){if(typeof galleries!="undefined"&&galleries[0].images.length>0){galleries[0].showImage(imageIndex-1);var img=galleries[0].images[imageIndex-1];var segmentID=img.segment_id;$("#divSegment .sTitle").html(img.title);$("#divSegment .sTitle").attr("title",img.title);$("#divSegment div.sMain>p").html(img.desc);loadSegment(segmentID)}}else{currentAlbumID=albumID;if($.fn.fancybox){$.fn.fancybox.Items=[]}currentSegmentID=-1;var now=new Date();var albumVersion=""+now.getFullYear()+(now.getMonth()+1)+now.getDate()+now.getHours()+now.getMinutes();var subids=",,"+albumID.toString()+",";if(albumID>0){$("#ulRightList li[parentid='"+albumID+"']").each(function(){subids+=","+$(this).attr("albumid")+","})}var objPhotos;if(typeof(strphotos)!="undefined"){strphotos=strphotos.replace(/\n/g,"\\n").replace(/\r/g,"\\r");objPhotos=eval("("+strphotos+")")}else{objPhotos=photoArray}$("ul#mainImgList").empty();var pi=1;for(var i=0;i<objPhotos.length;i++){if(albumID<=0||subids.indexOf(","+objPhotos[i].ParentID+",",0)>0){var photoPath=objPhotos[i].Path.replace(/[0-9]+x[0-9]+[_(0-9A-Za-z)]*.([a-zA-Z\?\=\-\:0-9]+?)$/ig,"1024x0.$1");var imgSrc=objPhotos[i].Path;var cdnSrc=imgSrc.replace(imgserver,cdnserver);var strLi="<li><a href='";strLi+=photoPath+"#"+albumID+"_"+(pi++).toString();strLi+="' org='";strLi+=photoPath.replace(imgserver,cdnserver);strLi+="' rel='history'><img class='bor4' src='";strLi+=cdnSrc;strLi+="' altsrc='"+imgSrc+"' onerror='imageError(this)'";strLi+=" segment_id='";strLi+=objPhotos[i].Remark;strLi+="'title=\""+HTMLEncode(objPhotos[i].Name)+'"';strLi+=" width='44' height='44' longdesc=\"";strLi+=HTMLEncode(objPhotos[i].Description);strLi+='"></a></li>';$("#mainImgList").append(strLi)}}galleries=$("#gallery").unbind("adGallery").adGallery({loader_image:LoadImgUrl,effect:slideShowAnimation,animation_speed:500,callbacks:{init:function(){this.preloadImage(0);this.preloadImage(1)},afterImageVisible:function(){var context=this;this.preloadImage(this.current_index+1,function(){context.loading(false)});$("#blowup").attr("org",$("#currentImage").attr("org"));$("#blowup").fancybox({frameWidth:700,frameHeight:585},true)}}});$("#photosContent").append("<em id='blowup' style='' class='blowupdef' >&nbsp;</em>");try{var pid=$("li[albumID='"+albumID+"']").attr("parentid");$("li[parentid='"+pid+"']").show();$("li[albumID='"+pid+"']>em.pucker").removeClass("pucopen").addClass("puclose")}catch(e){}$("li[albumID='"+albumID+"']").addClass("navclick").siblings("li").removeClass("navclick");if(typeof galleries!="undefined"&&galleries.length>0&&galleries[0].images.length>0){try{galleries[0].showImage(imageIndex-1)}catch(e){}var img=galleries[0].images[imageIndex-1];var segmentID=img.segment_id;$("#divSegment .sTitle").html(img.title);$("#divSegment .sTitle").attr("title",img.title);$("#divSegment div.sMain>p").html(img.desc);loadSegment(segmentID)}$("div[rel='history']").click(function(){if($(this).children("div").attr("class").indexOf("gray")<0){$.historyLoad($(this).attr("hash"))}return false});$("#mainImgList a[rel='history']").click(function(){var hash=this.href.replace(/.*#/,"");$.historyLoad(hash);return false}).fancybox({frameWidth:700,frameHeight:585},false);$("#getlink").click(function(){var current_url=$(this).attr("link");$(".ad-image-wrapper").find(".copy_url_dialog").remove();var copy_url_dialog=$('<div class="copy_url_dialog">Copy the URL below:<div class="url">'+current_url+'</div><div class="btnwrapper"><div class="btnclose" onclick="$(\'.ad-image-wrapper\').find(\'.copy_url_dialog\').remove()">Close</div><div class="btncopy" onclick="copyURL(\''+current_url+"')\">Copy to Clipboard</div></div></div>");$(".ad-image-wrapper").append(copy_url_dialog)})}}function loadSegment(a){$("#btnroomlink a").attr("href",a);if(a!=""&&a!="0"){$("#btnroomlink").show()}else{$("#btnroomlink").hide()}}function copyURL(b){try{window.clipboardData.setData("Text",b);alert("url is copyed")}catch(a){alert("url copy failed")}}function HTMLEncode(a){var c=document.createElement("div");(c.textContent!=null)?(c.textContent=a):(c.innerText=a);var b=c.innerHTML;c=null;return b}function HTMLDecode(c){var b=document.createElement("div");b.innerHTML=c;var a=b.innerText||b.textContent;b=null;return a}$(document).ready(function(){$(".ad-navigator-wrapper").hide();$(".ad-thumb-list>li>a>img").lazyload({placeholder:"/images/pending.gif",container:$(".ad-thumbs")});if(window.location.href.indexOf("#")<0||window.location.href.indexOf("_")<0){loadAlbum("0_1")}$(".gallRbar>div>dl>dt>a,.gallRbar>div>dl>dd>a").each(function(){if($(this).parent("dt").next("dd").children().length>0){$(this).removeClass("wp");$(this).parent("dt").prepend('<span style="position:absolute; width: 50px; height: 30px; z-index: 50;cursor: pointer;"></span>')}});$("#ulRightList li").click(function(){$.historyLoad($("a",$(this)).attr("href").replace(/.*#/,""))});$(".gallRbar>h3").toggle(function(){$(this).addClass("up").siblings("div").hide()},function(){$(this).removeClass("up").siblings("div").show()});$(".gallRbar>div>span").toggle(function(){$(this).next("a").removeClass("ex").siblings("dl").hide()},function(){$(this).next("a").addClass("ex").siblings("dl").show()});$(".gallRbar>div>dl>dt>span").click(function(){if($(this).next("a").attr("class").indexOf("ex")>=0){$(this).next("a").removeClass("ex").parent("dt").next("dd").hide()}else{$(this).next("a").addClass("ex").parent("dt").next("dd").show()}});$("#ulRightList>li>em.pucker").click(function(){var a=$(this).parent("li:eq(0)").attr("albumid");if($(this).hasClass("pucopen")){$(this).removeClass("pucopen").addClass("puclose").parent("li:eq(0)").siblings("li.subClass[parentid='"+a.toString()+"']").show();$("span.sonnav").wordLimit()}else{$(this).removeClass("puclose").addClass("pucopen").parent("li:eq(0)").siblings("li.subClass[parentid='"+a.toString()+"']").hide()}})});